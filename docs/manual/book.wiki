
<div class="maketitle">
    <h2 class="titleHead">Mongrel2 Manual<br>
    Installing, Deploying, Managing, Hacking</h2>

    <div class="author">
      <span class="pplr7t-x-x-120">Zed A. Shaw</span>
    </div><br>

    <div class="date">
      <span class="pplr7t-x-x-120">July 2010</span>
    </div>
  </div><!--l. 17-->

  <p class="indent">

  <h2 class="likechapterHead"><a id="x1-1000" name=
  "x1-1000"></a>Contents</h2>

  <div class="tableofcontents">
    <span class="chapterToc">1 <a href="#x1-40001" id="QQ2-1-4"
    name="QQ2-1-4">Introduction</a></span><br>
    &nbsp;<span class="sectionToc">1.1 <a href="#x1-50001.1" id=
    "QQ2-1-5" name="QQ2-1-5">Language Agnostic</a></span><br>
    &nbsp;<span class="sectionToc">1.2 <a href="#x1-60001.2" id=
    "QQ2-1-6" name="QQ2-1-6">Asynchronous</a></span><br>
    &nbsp;<span class="sectionToc">1.3 <a href="#x1-70001.3" id=
    "QQ2-1-7" name="QQ2-1-7">Message Protocol</a></span><br>
    &nbsp;<span class="sectionToc">1.4 <a href="#x1-80001.4" id=
    "QQ2-1-8" name="QQ2-1-8">Application Oriented</a></span><br>
    &nbsp;<span class="sectionToc">1.5 <a href="#x1-90001.5" id=
    "QQ2-1-9" name="QQ2-1-9">Automated Management</a></span><br>
    &nbsp;<span class="sectionToc">1.6 <a href="#x1-100001.6" id=
    "QQ2-1-10" name="QQ2-1-10">Using This Manual</a></span><br>
    <span class="chapterToc">2 <a href="#x1-110002" id="QQ2-1-11"
    name="QQ2-1-11">Installing</a></span><br>
    &nbsp;<span class="sectionToc">2.1 <a href="#x1-120002.1" id=
    "QQ2-1-12" name="QQ2-1-12">Install Dependencies</a></span><br>
    &nbsp;<span class="sectionToc">2.2 <a href="#x1-130002.2" id=
    "QQ2-1-14" name="QQ2-1-14">Building Mongrel2</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">2.2.1 <a href=
    "#x1-140002.2.1" id="QQ2-1-15" name="QQ2-1-15">Using
    Fossil</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">2.2.2 <a href=
    "#x1-150002.2.2" id="QQ2-1-17" name="QQ2-1-17">Using The .zip
    File</a></span><br>
    &nbsp;<span class="sectionToc">2.3 <a href="#x1-160002.3" id=
    "QQ2-1-18" name="QQ2-1-18">Building And
    Installing</a></span><br>
    &nbsp;<span class="sectionToc">2.4 <a href="#x1-170002.4" id=
    "QQ2-1-20" name="QQ2-1-20">Testing The
    Installation</a></span><br>
    &nbsp;<span class="sectionToc">2.5 <a href="#x1-180002.5" id=
    "QQ2-1-22" name="QQ2-1-22">Upgrading from trunk</a></span><br>
    &nbsp;<span class="sectionToc">2.6 <a href="#x1-190002.6" id=
    "QQ2-1-24" name="QQ2-1-24">Up Next</a></span><br>
    <span class="chapterToc">3 <a href="#x1-200003" id="QQ2-1-25"
    name="QQ2-1-25">Managing</a></span><br>
    &nbsp;<span class="sectionToc">3.1 <a href="#x1-210003.1" id=
    "QQ2-1-27" name="QQ2-1-27">Model-View-Controller</a></span><br>
    &nbsp;<span class="sectionToc">3.2 <a href="#x1-220003.2" id=
    "QQ2-1-28" name="QQ2-1-28">Trying m2sh</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.2.1 <a href=
    "#x1-230003.2.1" id="QQ2-1-31" name="QQ2-1-31">What The Hell
    Just Happened?</a></span><br>
    &nbsp;<span class="sectionToc">3.3 <a href="#x1-240003.3" id=
    "QQ2-1-32" name="QQ2-1-32">A Simple Configuration
    File</a></span><br>
    &nbsp;<span class="sectionToc">3.4 <a href="#x1-250003.4" id=
    "QQ2-1-35" name="QQ2-1-35">How A Config Is
    Structured</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.1 <a href=
    "#x1-260003.4.1" id="QQ2-1-36" name=
    "QQ2-1-36">Server</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.2 <a href=
    "#x1-270003.4.2" id="QQ2-1-37" name=
    "QQ2-1-37">Host</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.3 <a href=
    "#x1-280003.4.3" id="QQ2-1-38" name=
    "QQ2-1-38">Route</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.4 <a href=
    "#x1-290003.4.4" id="QQ2-1-39" name=
    "QQ2-1-39">Dir</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.5 <a href=
    "#x1-300003.4.5" id="QQ2-1-40" name=
    "QQ2-1-40">Proxy</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.6 <a href=
    "#x1-310003.4.6" id="QQ2-1-41" name=
    "QQ2-1-41">Handler</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">3.4.7 <a href=
    "#x1-320003.4.7" id="QQ2-1-42" name=
    "QQ2-1-42">Others</a></span><br>
    &nbsp;<span class="sectionToc">3.5 <a href="#x1-330003.5" id=
    "QQ2-1-43" name="QQ2-1-43">A More Complex
    Example</a></span><br>
    &nbsp;<span class="sectionToc">3.6 <a href="#x1-340003.6" id=
    "QQ2-1-45" name="QQ2-1-45">Routing And Host
    Patterns</a></span><br>
    &nbsp;<span class="sectionToc">3.7 <a href="#x1-350003.7" id=
    "QQ2-1-47" name="QQ2-1-47">Deployment Logs And
    Commits</a></span><br>
    <span class="chapterToc">4 <a href="#x1-360004" id="QQ2-1-49"
    name="QQ2-1-49">Deploying</a></span><br>
    &nbsp;<span class="sectionToc">4.1 <a href="#x1-370004.1" id=
    "QQ2-1-50" name="QQ2-1-50">Mongrel2 Deployment
    Requirements</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">4.1.1 <a href=
    "#x1-380004.1.1" id="QQ2-1-52" name="QQ2-1-52">Introducing
    procer</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">4.1.2 <a href=
    "#x1-390004.1.2" id="QQ2-1-53" name="QQ2-1-53">Installing
    procer</a></span><br>
    &nbsp;<span class="sectionToc">4.2 <a href="#x1-400004.2" id=
    "QQ2-1-55" name="QQ2-1-55">The Plan</a></span><br>
    &nbsp;<span class="sectionToc">4.3 <a href="#x1-410004.3" id=
    "QQ2-1-56" name="QQ2-1-56">Step 1: The Deployment
    Area</a></span><br>
    &nbsp;<span class="sectionToc">4.4 <a href="#x1-420004.4" id=
    "QQ2-1-58" name="QQ2-1-58">Step 2: The mongrel2.org
    Configuration</a></span><br>
    &nbsp;<span class="sectionToc">4.5 <a href="#x1-430004.5" id=
    "QQ2-1-60" name="QQ2-1-60">Step 3: Setup procer</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">4.5.1 <a href=
    "#x1-440004.5.1" id="QQ2-1-65" name="QQ2-1-65">The Python
    Examples</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">4.5.2 <a href=
    "#x1-450004.5.2" id="QQ2-1-69" name="QQ2-1-69">Testing The New
    Setup</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">4.5.3 <a href=
    "#x1-460004.5.3" id="QQ2-1-71" name="QQ2-1-71">Nice Features of
    Procer</a></span><br>
    &nbsp;<span class="sectionToc">4.6 <a href="#x1-470004.6" id=
    "QQ2-1-72" name="QQ2-1-72">Step 4: Static
    Content</a></span><br>
    &nbsp;<span class="sectionToc">4.7 <a href="#x1-480004.7" id=
    "QQ2-1-74" name="QQ2-1-74">Step 5: Testing And
    Troubleshooting</a></span><br>
    &nbsp;<span class="sectionToc">4.8 <a href="#x1-490004.8" id=
    "QQ2-1-75" name="QQ2-1-75">Further Improvements</a></span><br>
    <span class="chapterToc">5 <a href="#x1-500005" id="QQ2-1-76"
    name="QQ2-1-76">Hacking</a></span><br>
    &nbsp;<span class="sectionToc">5.1 <a href="#x1-510005.1" id=
    "QQ2-1-78" name="QQ2-1-78">Front-end Goodies</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.1 <a href=
    "#x1-520005.1.1" id="QQ2-1-79" name=
    "QQ2-1-79">HTTP</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.2 <a href=
    "#x1-530005.1.2" id="QQ2-1-81" name=
    "QQ2-1-81">Proxying</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.3 <a href=
    "#x1-540005.1.3" id="QQ2-1-82" name=
    "QQ2-1-82">WebSockets</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.4 <a href=
    "#x1-550005.1.4" id="QQ2-1-84" name=
    "QQ2-1-84">JSSocket</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.5 <a href=
    "#x1-560005.1.5" id="QQ2-1-85" name="QQ2-1-85">Long
    Poll</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.6 <a href=
    "#x1-570005.1.6" id="QQ2-1-86" name=
    "QQ2-1-86">Streaming</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.1.7 <a href=
    "#x1-580005.1.7" id="QQ2-1-87" name="QQ2-1-87">N:M
    Responses</a></span><br>
    &nbsp;<span class="sectionToc">5.2 <a href="#x1-590005.2" id=
    "QQ2-1-88" name="QQ2-1-88">Introduction to 0MQ</a></span><br>
    &nbsp;<span class="sectionToc">5.3 <a href="#x1-600005.3" id=
    "QQ2-1-89" name="QQ2-1-89">Handlers And Formats</a></span><br>
    &nbsp;<span class="sectionToc">5.4 <a href="#x1-610005.4" id=
    "QQ2-1-90" name="QQ2-1-90">Python Handler API</a></span><br>
    &nbsp;<span class="sectionToc">5.5 <a href="#x1-620005.5" id=
    "QQ2-1-91" name="QQ2-1-91">Basic Handler Demo</a></span><br>
    &nbsp;<span class="sectionToc">5.6 <a href="#x1-630005.6" id=
    "QQ2-1-92" name="QQ2-1-92">Chat Demo</a></span><br>
    &nbsp;<span class="sectionToc">5.7 <a href="#x1-640005.7" id=
    "QQ2-1-93" name="QQ2-1-93">MP3 Streaming Demo</a></span><br>
    &nbsp;<span class="sectionToc">5.8 <a href="#x1-650005.8" id=
    "QQ2-1-94" name="QQ2-1-94">Other Language APIs</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.8.1 <a href=
    "#x1-660005.8.1" id="QQ2-1-95" name="QQ2-1-95">Ruby Handler
    API</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.8.2 <a href=
    "#x1-670005.8.2" id="QQ2-1-96" name="QQ2-1-96">C++ Handler
    API</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.8.3 <a href=
    "#x1-680005.8.3" id="QQ2-1-97" name="QQ2-1-97">PHP Handler
    API</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.8.4 <a href=
    "#x1-690005.8.4" id="QQ2-1-98" name="QQ2-1-98">Writing Your
    Own</a></span><br>
    &nbsp;<span class="sectionToc">5.9 <a href="#x1-700005.9" id=
    "QQ2-1-99" name="QQ2-1-99">Config Database
    Schema</a></span><br>
    &nbsp;&nbsp;<span class="subsectionToc">5.9.1 <a href=
    "#x1-710005.9.1" id="QQ2-1-100" name="QQ2-1-100">Writing Your
    Own m2sh</a></span><br>
    <span class="chapterToc">6 <a href="#x1-720006" id="QQ2-1-101"
    name="QQ2-1-101">Contributing</a></span>
  </div><!--l. 1-->

  <p class="indent">

  <h2 class="likechapterHead"><a id="x1-2000" name=
  "x1-2000"></a>Preface</h2><!--l. 3-->

  <p class="noindent">This manual will tell you about the most
  awesome webserver on the planet: Mongrel2. It is written for
  people with a sense of humor who want to get things done with
  Mongrel2. That means if you&rsquo;re an operations professional,
  software developer, hacker, or just curious it&rsquo;s for you.
  However, if you&rsquo;re too serious and think &rdquo;flowery
  language&rdquo; (aka good entertaining writing) does not belong
  in your software manuals then you should just go read the source
  code and save everyone a huge headache dealing with you. 
  <!--l. 11-->

  <p class="indent">In case you haven&rsquo;t figured it out, this
  book will be fun and slightly obnoxious. That&rsquo;s not
  intended to insult you, but just to keep you interested so that
  you want to read it.

  <h3 class="likesectionHead"><a id="x1-3000" name=
  "x1-3000"></a>Typography</h3><!--l. 18-->

  <p class="noindent">Usually the people running the web can be
  divided into three types of people: Steves, Edsgers, and Knuths. 
  <!--l. 21-->

  <p class="indent">The Steves think that the entire internet
  should be a wonderful user experience where all pages are crafted
  with pixel perfect fonts with high gloss visuals and coated with
  the most happy happy joy joy of all possible experiences. To them
  design is paramount and actual stability isn&rsquo;t important
  unless it interferes with design. The Steves of the internet
  think the Edsgers of internet are destroying the universe with
  things like &rdquo;functionality&rdquo;, &rdquo;security&rdquo;,
  and &rdquo;stability&rdquo;. Just like the real Steve Jobs, they
  would rather everything look fantastic and then use awesome
  marketing to cover up any technical flaws. <!--l. 31-->

  <p class="indent">The Edsgers feel that the internet is
  completely unsafe and until it is a fully curate and crafted set
  of academic peer reviewed papers it will be a festering pile of
  dung. To the Edsgers the world is dangerous and only a truly
  paranoid attitude toward security and stability will ensure that
  it becomes safe. They want every single piece of software to
  reject all reality and be crafted from nothing but pure
  mathematics, and hate the fact that the Steves want to run around
  painting the world with useless frivolous colors and words and
  things that lead to ambiguity and happiness. <!--l. 40-->

  <p class="indent">The typography in this book, and the entire
  project, is for the Knuths of the world. I like to think of the
  Knuths as the practical yet professional types with a light sense
  of humor. They are the ones who are getting things done while
  still balancing between great typography and solid bug free
  functionality. They aren&rsquo;t zealots but practical straight
  forward type of people. <!--l. 47-->

  <p class="indent">That is why this book is written in TeX and why
  it uses whatever fonts TeX uses.

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;1</span><br>
  <a id="x1-40001" name="x1-40001"></a>Introduction</h2><!--l. 3-->

  <p class="noindent">Mongrel2 is a web server. HTTP requests come
  in, HTTP responses go out. Request, response. There is nothing
  revolutionary or extravagant in what Mongrel2 does with a
  browser, apart from supporting fancy asynchronous socket
  protocols. To the browser, Mongrel2 is just this nice web server
  that has WebSockets and Flash Sockets in it. That&rsquo;s it. 
  <!--l. 9-->

  <p class="indent">What makes Mongrel2 special is how it satisfies
  these requests in a <span class="pplri7t-">language</span>
  <span class="pplri7t-">agnostic</span> and <span class=
  "pplri7t-">asynchronous</span> way using a <span class=
  "pplri7t-">simple messaging protocol</span> to talk to
  <span class="pplri7t-">applications</span> not just serve files.
  Mongrel2 is also designed to be incredibly easy to <span class=
  "pplri7t-">automatically</span> <span class=
  "pplri7t-">manage</span> it as part of your infrastructure. 
  <!--l. 15-->

  <p class="indent">Other web servers do some of these things, but
  they either do them in a bastardized way or not all of them at
  once. Plenty of language specific web servers like Node.js and
  Jetty have asynchronous operation, but then they&rsquo;re not
  language agnostic <span class="footnote-mark"><a href=
  "book-final2.html#fn1x2"><sup class=
  "textsuperscript">1</sup></a></span><a id="x1-4001f1" name=
  "x1-4001f1"></a>. Other web servers will let you talk to any
  language as a backend, but they insist on using HTTP proxying or
  FastCGI which is <span class="pplri7t-">not</span> friendly to
  asynchronous operations. <!--l. 22-->

  <p class="indent">Mongrel2 is the only web server I know of that
  actively tries to focus on these features as a cohesive whole.

  <h3 class="sectionHead"><span class="titlemark">1.1</span> <a id=
  "x1-50001.1" name="x1-50001.1"></a>Language Agnostic</h3>
  <!--l. 28-->

  <p class="noindent">The term &rdquo;language agnostic&rdquo; came
  from people who read about Mongrel2 in the early days and it
  means that Mongrel2 does <span class="pplri7t-">not</span> try to
  promote or any one language over any others. Mongrel2 does not
  care if you run a &rdquo;Python shop&rdquo; or if you&rsquo;re a
  die hard PHP fan or if you hate PHP and love only Ruby on Rails.
  Mongrel2 only knows about HTTP requests, HTTP responses, async
  messages, and getting them to your gear to meet those
  requirements. <!--l. 35-->

  <p class="indent">Language Agnosticism is the most important
  feature of Mongrel2 and it&rsquo;s entire purpose stems from the
  desire to reduce the amount of programming language religion in
  the world. Real people want to get things done, not wanker on
  which technology is the best or force other people to use their
  favorite toys. Instead Mongrel2 works to just be great for every
  language and make it easy to use what works best for a given
  problem. <!--l. 43-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">1.2</span> <a id=
  "x1-60001.2" name="x1-60001.2"></a>Asynchronous</h3><!--l. 45-->

  <p class="noindent">Many web servers are
  &rdquo;asynchronous&rdquo; internally, and some others force you
  to know way too much about how they work internally to get
  anything done. What makes Mongrel2&rsquo;s version of
  asynchronous messaging different is it extends to <span class=
  "pplri7t-">outside</span> the Mongrel2 server. This is a powerful
  concept that even your backends can operate asynchronously using
  simple identification of connected clients. <!--l. 51-->

  <p class="indent">Other servers assume that every request is
  received by a browser, then sent to a backend, and then directly
  sent out to the client and that&rsquo;s it. Mongrel2 assumes that
  there is a connected client, and it sends requests to backends,
  but it makes no assumptions about how those backends respond to
  the clients. All it requires is that the backend application send
  messages addressed to the client and it will write them on the
  socket. <!--l. 58-->

  <p class="indent">Because of this design Mongrel2 can easily
  house both classic HTTP clients, keep-alive style HTTP client,
  chunked encoding responses, JSSockets, or WebSockets using the
  same code. <!--l. 63-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">1.3</span> <a id=
  "x1-70001.3" name="x1-70001.3"></a>Message Protocol</h3>
  <!--l. 65-->

  <p class="noindent">In order to properly do asynchronous
  messaging in a language agnostic way, Mongrel2 needed a good base
  protocol that allowed for different messaging styles and worked
  with many different languages. HTTP proxying already does this,
  although it&rsquo;s not asynchronous at all. What gives Mongrel2
  its special powers is ZeroMQ, a language and transport mechanism
  agnostic messaging system that does <span class=
  "pplri7t-">not</span> require a centralized messaging server to
  operate. <!--l. 72-->

  <p class="indent">Using ZeroMQ lets Mongrel2 talk to a huge
  number of languages, operate within any kind of network
  architecture, and do it with a very simple communication model
  and API that most programmers can understand. <!--l. 77-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">1.4</span> <a id=
  "x1-80001.4" name="x1-80001.4"></a>Application Oriented</h3>
  <!--l. 79-->

  <p class="noindent">Web servers today are written as if it was
  still 1995 and all anyone needs to do is serve files, maybe some
  graphics. Today&rsquo;s web applications are not about serving
  files, they&rsquo;re about serving application logic <span class=
  "pplri7t-">and</span> doing it asynchronously. The advent of the
  bewildering numbers of ways to hack HTTP into an async messaging
  protocol<span class="footnote-mark"><a href=
  "book-final3.html#fn2x2"><sup class=
  "textsuperscript">2</sup></a></span><a id="x1-8001f2" name=
  "x1-8001f2"></a> is proof enough that the pressure is on for web
  server to be for applications with highly interactive interfaces.
  <!--l. 87-->

  <p class="indent">Mongrel2 can still serve files just fine. In
  fact, it&rsquo;s got very accurate and easy to understand file
  serving code. However, Mongrel2 will always be about
  applications. Fast scalable awesome asynchronous or synchronous
  applications that need to use languages that mere mortals can
  work with like PHP. If there&rsquo;s ever a choice, apps win.

  <h3 class="sectionHead"><span class="titlemark">1.5</span> <a id=
  "x1-90001.5" name="x1-90001.5"></a>Automated Management</h3>
  <!--l. 94-->

  <p class="noindent">The language agnostic philosophy even extends
  to the configuration system where you can use any language you
  need to configure it and manage it, as long as the results are a
  SQLite3 database Mongrel2 can read and work with to run. There
  are great tools for managing this database already written in
  Python, but if you hate Python then you can write anything you
  want. <!--l. 100-->

  <p class="indent">This pattern is established with servers like
  Postfix, Exim, Sendmail, qmail, and others that convert
  configuration files to half-assed SQL databases. Mongrel2
  effectively adopts a Model-View-Controller design for its
  configuration system, the same way every web application is
  designed today. The Model is a SQlite3 database file, which any
  programming language can access. The Controller is a Mongrel2
  process that reads this file and sets itself up accordingly. 
  <!--l. 108-->

  <p class="indent">The View is a Python script called m2sh that
  gives you a command line &rdquo;UI&rdquo; to configure and setup
  the Mongrel2 sqlite model. It gives you commands for managing it,
  crafting configurations, looking at them, the works. 
  <!--l. 112-->

  <p class="indent">But most importantly, <span class=
  "pplri7t-">you can write your own</span>. You don&rsquo;t have to
  wait for a Mongrel2 developer to craft a configuration file
  parser for your favorite language, or use some hack job Nagios
  Perl junk to automate or scan it. It&rsquo;s SQlite3 with a solid
  simple schema and well written Python code showing you how it
  works. <!--l. 118-->

  <p class="indent">Nothing stops you from automating the hell out
  of Mongrel2 with that. <!--l. 121-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">1.6</span> <a id=
  "x1-100001.6" name="x1-100001.6"></a>Using This Manual</h3>
  <!--l. 123-->

  <p class="noindent">This manual is intended to be fun to read, so
  probably the best way to use it is to actually <span class=
  "pplri7t-">read it</span>. <!--l. 126-->

  <p class="indent">I know, revolutionary right. I mean, who has
  time to read and learn about something these days. You just want
  to get in there and get whatever problem you have done. Now! No
  time for words. You just want a straight dump right into your
  brain so that you are able to solve all your problems instantly
  and screw all this talking. <!--l. 131-->

  <p class="indent">You ever ask yourself if this attitude about
  not wanting to read and learn is possibly the reason you always
  get stuck in emergencies with no time to read and learn? 
  <!--l. 135-->

  <p class="indent">Something to think about. <!--l. 137-->

  <p class="indent">My recommendation is that you go through every
  page of this manual and do the stuff in it. Even if you think you
  won&rsquo;t need something, because you&rsquo;re not a
  programmer, or you&rsquo;re not in operations, you should learn
  it. Doing so will make the parts you do need clearer and give you
  better ideas for later.

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;2</span><br>
  <a id="x1-110002" name="x1-110002"></a>Installing</h2><!--l. 3-->

  <p class="noindent">Mongrel2 is designed to build on most modern
  Unix systems, specifically Linux and Mac OSX. It is written in C
  (<span class="pplri7t-">not Ruby</span>) and uses fairly vanilla
  C and standard libraries, except for one piece that implements
  the internal coroutines. Other than this you should be able to
  compile and install Mongrel2 with nothing more than <span class=
  "pplri7t-">make all install</span> after you&rsquo;ve installed
  all the dependencies. <!--l. 10-->

  <p class="indent">Now, if when I said dependencies you started to
  groan at having to install software to use my software, well my
  friend, welcome to the future. You said you don&rsquo;t want
  people reinventing the wheel right? Great, that means you need to
  install software for my software to work. It&rsquo;s either that
  or wait 10 years for me to build everything from scratch like
  some arrogant jackass. <!--l. 17-->

  <p class="indent">We good now? Great, let&rsquo;s get started.

  <h3 class="sectionHead"><span class="titlemark">2.1</span> <a id=
  "x1-120002.1" name="x1-120002.1"></a>Install Dependencies</h3>
  <!--l. 21-->

  <p class="noindent">To get everything working you will need the
  following dependencies:

  <ul class="itemize1">
    <li class="itemize">GNU make (gmake).

    <li class="itemize"><a href="http://zeromq.org">ZeroMQ</a> for
    the messaging.

    <li class="itemize"><a href="http://python.org">Python 2.6</a>
    for the m2sh management and examples.

    <li class="itemize"><a href=
    "http://www.sqlite.org/">SQLite3</a> and make sure <span class=
    "pplri7t-">Python</span> has the ability to access SQLite3.

    <li class="itemize"><a href=
    "http://pypi.python.org/pypi/distribute">distribute</a> and
    <a href="http://pypi.python.org/pypi/pip/0.7.2">pip</a>.

    <li class="itemize"><a href=
    "http://github.com/zeromq/pyzmq">PyZMQ</a> for the examples.

    <li class="itemize"><a href="http://webpy.org/">web.py</a> for
    the examples.
  </ul><!--l. 33-->

  <p class="indent">If you install these things in this order, then
  everything should be good. Typically people run into problems if
  they do this out of order, for example trying to install Mongrel2
  before they have distribute and pip installed. <!--l. 37-->

  <p class="indent">Since every system is different it is difficult
  to tell you exactly how to install required packages for your OS,
  but here&rsquo;s how I did it on my computer: <!--l. 41-->

  <p class="indent"><a id="x1-12001r1" name="x1-12001r1"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 1:</span> <span class=
      "content"><span class="pplri7t-">Installing Dependencies
      on</span> <span class="pplri7t-">ArchLinux</span></span>
    </div><!--tex4ht:label?: x1-12001r1 -->

    <div class="fancyvrb" id="fancyvrb1">
      <a id="x1-12003r1" name="x1-12003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;ZeroMQ</span><br class="fancyvrb">
      <a id="x1-12005r2" name="x1-12005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;wget</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://www.zeromq.org/local--files/area:download/zeromq-2.0.7.tar.gz</span><br class="fancyvrb">
      <a id="x1-12007r3" name="x1-12007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;tar</span><span class=
      "pcrr7t-x-x-90">&nbsp;-xzvf</span><span class=
      "pcrr7t-x-x-90">&nbsp;zeromq-2.0.7.tar.gz</span><br class=
      "fancyvrb">
      <a id="x1-12009r4" name="x1-12009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;zeromq-2.0.7/</span><br class=
      "fancyvrb">
      <a id="x1-12011r5" name="x1-12011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;./configure</span><br class="fancyvrb">
      <a id="x1-12013r6" name="x1-12013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><br class="fancyvrb">
      <a id="x1-12015r7" name="x1-12015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><br class="fancyvrb">
      <a id="x1-12017r8" name="x1-12017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-12019r9" name="x1-12019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><br class="fancyvrb">
      <a id="x1-12021r10" name="x1-12021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pacman</span><span class=
      "pcrr7t-x-x-90">&nbsp;-S</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><br class="fancyvrb">
      <a id="x1-12023r11" name="x1-12023r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-12025r12" name="x1-12025r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;sqlite3</span><br class="fancyvrb">
      <a id="x1-12027r13" name="x1-12027r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pacman</span><span class=
      "pcrr7t-x-x-90">&nbsp;-S</span><span class=
      "pcrr7t-x-x-90">&nbsp;sqlite3</span><br class="fancyvrb">
      <a id="x1-12029r14" name="x1-12029r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-12031r15" name="x1-12031r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;distribute</span><span class=
      "pcrr7t-x-x-90">&nbsp;and</span><span class=
      "pcrr7t-x-x-90">&nbsp;pip</span><br class="fancyvrb">
      <a id="x1-12033r16" name="x1-12033r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pacman</span><span class=
      "pcrr7t-x-x-90">&nbsp;-S</span><span class=
      "pcrr7t-x-x-90">&nbsp;python-pip</span><br class="fancyvrb">
      <a id="x1-12035r17" name="x1-12035r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pip</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;distribute</span><br class="fancyvrb">
      <a id="x1-12037r18" name="x1-12037r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-12039r19" name="x1-12039r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;PyZMQ</span><span class=
      "pcrr7t-x-x-90">&nbsp;from</span><span class=
      "pcrr7t-x-x-90">&nbsp;github</span><br class="fancyvrb">
      <a id="x1-12041r20" name="x1-12041r20"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pacman</span><span class=
      "pcrr7t-x-x-90">&nbsp;-S</span><span class=
      "pcrr7t-x-x-90">&nbsp;git</span><br class="fancyvrb">
      <a id="x1-12043r21" name="x1-12043r21"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;git</span><span class=
      "pcrr7t-x-x-90">&nbsp;clone</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://github.com/zeromq/pyzmq.git</span><br class="fancyvrb">
      <a id="x1-12045r22" name="x1-12045r22"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;setup.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><br class="fancyvrb">
      <a id="x1-12047r23" name="x1-12047r23"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-12049r24" name="x1-12049r24"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;web.py</span><br class="fancyvrb">
      <a id="x1-12051r25" name="x1-12051r25"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;pip</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><span class=
      "pcrr7t-x-x-90">&nbsp;web.py</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 71-->

  <p class="indent">If you run into parts that your OS is missing,
  which is likely on Debian and SuSE systems, then you&rsquo;ll
  have to go and figure out how to install it.

  <h3 class="sectionHead"><span class="titlemark">2.2</span> <a id=
  "x1-130002.2" name="x1-130002.2"></a>Building Mongrel2</h3>
  <!--l. 78-->

  <p class="noindent">If everything went well you should be able to
  grab the Mongrel2 source and try building it. There&rsquo;s two
  ways you can get the source code to Mongrel2: <!--l. 82-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-13002x1">Install <a href=
    "http://fossil-scm.org">Fossil SCM</a> and check out the
    source.

    <li class="enumerate" id="x1-13004x2">Grab the source .zip
    release and install it from there.
  </ol><!--l. 87-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">2.2.1</span>
  <a id="x1-140002.2.1" name="x1-140002.2.1"></a>Using Fossil</h4>
  <!--l. 89-->

  <p class="noindent">Since it&rsquo;s early in Mongrel2
  development we recommend you get fossil and install it so you can
  track the latest fixes and development. Here&rsquo;s the easiest
  way to do that: <!--l. 93-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-14002x1">Go to <a href=
    "http://www.fossil-scm.org/download.html">the fossil download
    page</a> and grab the binary that fits your system, or the
    source tar.gz.

    <li class="enumerate" id="x1-14004x2">Follow their <a href=
    "http://fossil-scm.org/index.html/doc/tip/www/build.wiki">install
    instructions</a> to get it on your system.

    <li class="enumerate" id="x1-14006x3">If you find that your
    version of fossil ends up having problems with mongrel2.org let
    us know since we might need to upgrade.
  </ol><!--l. 102-->

  <p class="indent">Once you have fossil you can then get the
  Mongrel2 source and open it up: <!--l. 104-->

  <p class="indent"><a id="x1-14007r2" name="x1-14007r2"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 2:</span> <span class=
      "content"><span class="pplri7t-">Cloning The Mongrel2</span>
      <span class="pplri7t-">Source</span></span>
    </div><!--tex4ht:label?: x1-14007r2 -->

    <div class="fancyvrb" id="fancyvrb2">
      <a id="x1-14009r1" name="x1-14009r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/fossils</span><br class="fancyvrb">
      <a id="x1-14011r2" name="x1-14011r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;fossil</span><span class=
      "pcrr7t-x-x-90">&nbsp;clone</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://mongrel2.org</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/fossils/mongrel2.fossil</span><br class="fancyvrb">
      <a id="x1-14013r3" name="x1-14013r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-14015r4" name="x1-14015r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-14017r5" name="x1-14017r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;fossil</span><span class=
      "pcrr7t-x-x-90">&nbsp;open</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/fossils/mongrel2.fossil</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 114-->

  <p class="indent">Make sure you do this in order (just like with
  every set of instructions you should follow) or else you&rsquo;ll
  get errors. For example, if you don&rsquo;t make the <span class=
  "pplb7t-">&nbsp;/fossils</span> directory then you&rsquo;ll get
  an error saying fossil can&rsquo;t open your file to clone. Well,
  that&rsquo;s because you <span class="pplri7t-">didn&rsquo;t make
  the</span> <span class="pplri7t-">&nbsp;/fossils
  directory</span>. Just pay attention and don&rsquo;t blame fossil
  if you can&rsquo;t.

  <h4 class="subsectionHead"><span class="titlemark">2.2.2</span>
  <a id="x1-150002.2.2" name="x1-150002.2.2"></a>Using The .zip
  File</h4><!--l. 123-->

  <p class="noindent">If you don&rsquo;t want to install fossil
  then you will need to get the .zip file from our site and install
  it that way. Since the code is new you have <span class=
  "pplri7t-">no guarantees</span> that this will work at all or
  that you will get a stable server. We have not made an official
  release, so using the .zip file is effectively a lame way of
  avoiding using fossil. <!--l. 129-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-15002x1">Login as an anonymous
    user <a href="http://mongrel2.org/login">at mongrel2.org</a>.

    <li class="enumerate" id="x1-15004x2">Go to the <a href=
    "http://mongrel2.org/info/tip">latest source tip</a>.

    <li class="enumerate" id="x1-15006x3">Click on the &rdquo;ZIP
    archive&rdquo; link to download the latest zip file of the
    source.

    <li class="enumerate" id="x1-15008x4">Unzip this file and cd
    into the resulting directory.
  </ol><!--l. 137-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">2.3</span> <a id=
  "x1-160002.3" name="x1-160002.3"></a>Building And Installing</h3>
  <!--l. 139-->

  <p class="noindent">Once you have the source ready to go you can
  build it and then install it with one command: <span class=
  "pplri7t-">make all install</span> <!--l. 142-->

  <p class="indent">There is no <span class=
  "pplri7t-">./configure</span> for Mongrel2 since we avoid too
  many OS specific differences or shield those away with good
  feature checks in the code. <!--l. 145-->

  <p class="indent">The end result of this should be: <!--l. 147-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-16002x1">Mongrel2 builds and
    compiles without errors.

    <li class="enumerate" id="x1-16004x2">All the unit tests run,
    please tell us about failures.

    <li class="enumerate" id="x1-16006x3">The Python libraries that
    m2sh needs get installed.

    <li class="enumerate" id="x1-16008x4">The m2sh itself gets
    installed.

    <li class="enumerate" id="x1-16010x5">Finally the mongrel2
    binary gets installed.
  </ol><!--l. 155-->

  <p class="indent">If any of these stages fail, then you can
  simply try to fix them and then run: <span class=
  "pplri7t-">make</span> <span class="pplri7t-">clean all
  install</span> which will do everything all over again. 
  <!--l. 158-->

  <p class="indent">The most common error is if you didn&rsquo;t
  install pip or distribute and insist on using your own
  system&rsquo;s package management. Do <span class=
  "pplri7t-">not</span> report bugs about your own flavor of
  Linux&rsquo;s stupidity about versions and how it installs
  Python. If you don&rsquo;t want to use the package system every
  other Python programmer uses then you&rsquo;re on your own. 
  <!--l. 164-->

  <p class="indent"><a id="x1-16011r1" name="x1-16011r1"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 1:</span> <span class=
      "content"><span class="pplri7t-">Use Virtualenv If You
      Fear</span> <span class="pplri7t-">Pip</span></span>
    </div><!--tex4ht:label?: x1-16011r1 -->

    <div class="quote">
      <!--l. 165-->

      <p class="noindent">For those who still want to use the
      package management but want to use pip and distribute I
      suggest you check out <a href=
      "http://pypi.python.org/pypi/virtualenv">virtualenv</a>. What
      virtualenv does is create a little &rdquo;chroot
      install&rdquo; of just the packages you need using pip or
      distribute. When you don&rsquo;t want them anymore you can
      just delete one directory and you&rsquo;re fine.
    </div>
  </div>
  <hr class="endfloat">

  <h3 class="sectionHead"><span class="titlemark">2.4</span> <a id=
  "x1-170002.4" name="x1-170002.4"></a>Testing The
  Installation</h3><!--l. 175-->

  <p class="noindent">When you are done you probably want to make
  sure that it installed correctly. There&rsquo;s a test
  configuration file in <span class=
  "pplb7t-">tests/config.sqlite</span> that you can use to try it
  out: <!--l. 179-->

  <p class="indent"><a id="x1-17001r3" name="x1-17001r3"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 3:</span> <span class=
      "content"><span class="pplri7t-">First Test</span>
      <span class="pplri7t-">Run</span></span>
    </div><!--tex4ht:label?: x1-17001r3 -->

    <div class="fancyvrb" id="fancyvrb3">
      <a id="x1-17003r1" name="x1-17003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><br class="fancyvrb">
      <a id="x1-17005r2" name="x1-17005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs</span><br class="fancyvrb">
      <a id="x1-17007r3" name="x1-17007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;tmp</span><br class="fancyvrb">
      <a id="x1-17009r4" name="x1-17009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;dump</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-17011r5" name="x1-17011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 189-->

  <p class="indent">That&rsquo;s it. Just hit CTRL-c for now and
  we&rsquo;ll get into playing with this setup later.

  <h3 class="sectionHead"><span class="titlemark">2.5</span> <a id=
  "x1-180002.5" name="x1-180002.5"></a>Upgrading from trunk</h3>
  <!--l. 193-->

  <p class="indent"><a id="x1-18001r4" name="x1-18001r4"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 4:</span> <span class=
      "content"><span class="pplri7t-">Update your</span>
      <span class="pplri7t-">checkout</span></span>
    </div><!--tex4ht:label?: x1-18001r4 -->

    <div class="fancyvrb" id="fancyvrb4">
      <a id="x1-18003r1" name="x1-18003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-18005r2" name="x1-18005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;fossil</span><span class=
      "pcrr7t-x-x-90">&nbsp;pull</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://mongrel2.org</span><br class=
      "fancyvrb">
      <a id="x1-18007r3" name="x1-18007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;fossil</span><span class=
      "pcrr7t-x-x-90">&nbsp;update</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 201-->

  <p class="noindent">Don&rsquo;t forget <span class=
  "pplri7t-">make clean all install</span>.

  <h3 class="sectionHead"><span class="titlemark">2.6</span> <a id=
  "x1-190002.6" name="x1-190002.6"></a>Up Next</h3><!--l. 206-->

  <p class="noindent">You now should have a working Mongrel2 system
  installed and the m2sh configuration interface ready to go. In
  the rest of this manual we&rsquo;ll be simply learning how to do
  more with Mongrel2 like making our own configs, writing handlers,
  and other fun stuff. <!--l. 1-->

  <p class="indent">

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;3</span><br>
  <a id="x1-200003" name="x1-200003"></a>Managing</h2><!--l. 3-->

  <p class="noindent">Mongrel2 is designed to be easy to deploy and
  <span class="pplri7t-">automate</span> the deployment. This is
  why it uses <a href="http://www.sqlite.org/">SQLite</a> to store
  the configuration, but <span class="pplri7t-">m2sh</span> as an
  interface to creating the configuration. Doing this lets you
  access the configuration using any language that works for you,
  augment it, alter it, migrate it, and automate it. <!--l. 9-->

  <p class="indent">In this chapter I&rsquo;m going to show you how
  to make a basic configuration using m2sh and all the commands
  that are available. You&rsquo;ll learn how the configuration
  system is structured so that you know what goes where, but in the
  end it&rsquo;s just a simple storage mechanism. <!--l. 14-->

  <p class="indent"><a id="x1-20001r2" name="x1-20001r2"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 2:</span> <span class=
      "content"><span class="pplri7t-">Apparently SQL
      Inspires</span> <span class="pplri7t-">FUD</span></span>
    </div><!--tex4ht:label?: x1-20001r2 -->

    <div class="quote">
      <!--l. 15-->

      <p class="noindent">When I first started talking about
      Mongrel2 I said I&rsquo;d store the configuration in SQLite
      and do a Model-View-Controller kind of design. Immediately
      people who can&rsquo;t read flipped out and though this meant
      they&rsquo;d be back in &rdquo;windows registry hell&rdquo;
      but with SQL as their only way to access it. They thought
      that they&rsquo;d be stuck writing configurations with SQL.
      That SQL couldn&rsquo;t possibly configure a web server. 
      <!--l. 21-->

      <p class="noindent">They were wrong on many levels. Nobody
      was <span class="pplri7t-">ever</span> going to make
      <span class="pplri7t-">anyone</span> use SQL. That was
      repeated over and over, but again, people don&rsquo;t read
      and love spreading FUD. The SQLite config database is nothing
      like the Windows Registry. No other web server really uses a
      true hierarchy, they just cram a relational model into a
      weirdo configuration format. The real goal was to make a web
      server that was easy to manage from <span class=
      "pplri7t-">any</span> language, and then give people a nice
      tool to get their job done without having to ever touch SQL.
      <span class="pplri7t-">EVER!</span> <!--l. 29-->

      <p class="noindent">In the end, what we got despite all this
      fear mongering is a bad ass configuration tool and a design
      that is simple, elegant, and works fantastic. If you read
      that Mongrel2 uses SQLite and though this was weird, well
      welcome to the future. Sometimes it&rsquo;s weird out here
      (even though, Postfix has been doing this for a decade or
      more).
    </div>
  </div>
  <hr class="endfloat">

  <h3 class="sectionHead"><span class="titlemark">3.1</span> <a id=
  "x1-210003.1" name="x1-210003.1"></a>Model-View-Controller</h3>
  <!--l. 38-->

  <p class="noindent">When you hear Model-View-Controller you think
  about web applications. This is a design pattern where you place
  different concerns into different parts of your system and try
  not to mix them too much. For an interactive application, if you
  keep the part that stores data (Model) separated from the logic
  (Controller) and use another piece to display and interact with
  the user (View) then it&rsquo;s easier to change the system and
  adapt it over time to new features. <!--l. 44-->

  <p class="indent">The power of MVC is simply that these things
  really are separate orthogonal pieces that get ugly if
  they&rsquo;re mixed together. There&rsquo;s not math or theory
  that says why, just lots of experience has told us it&rsquo;s
  usually a bad idea. When you start mixing them you find out that
  it&rsquo;s hard to change for new requirements later because
  you&rsquo;ve sprinkled logic all over your web pages. Or you
  can&rsquo;t update your database because there&rsquo;s all these
  stored procedures that assume the tables are a certain way. 
  <!--l. 51-->

  <p class="indent">Mongrel2 needed a way to allow you to use
  various languages and tools to automate its configuration.
  Letting you automate your deployments is the entire point of the
  server. The idea was that if we gave you the Controller and the
  Model, then you can craft any <span class="pplri7t-">View</span>
  you wanted, and there&rsquo;s no better Model than a SQL database
  like SQLite. It&rsquo;s embeddable, easily accessed from C or any
  language, portable, small, fast enough, and full of all the
  features you need and then some. <!--l. 57-->

  <p class="indent">What you are doing when you use m2sh to
  configure a configuration for Mongrel2 is working with a View
  we&rsquo;ve given you to create a Model for the Mongrel2 server
  to work with. That&rsquo;s it, and you can create your own View
  if you want. It could be automated deployment scripts, a web
  interface, monitoring scripts, anything you need. <!--l. 62-->

  <p class="indent">The point is, if you just want to get Mongrel2
  up and running, then use m2sh. If you want to do more advanced
  stuff, then get into the configuration database schema and see
  what you can do. The structure of the database very closely
  matches Mongrel2&rsquo;s internal structure, so understanding
  that means you understand how Mongrel2 works. This is a vast
  improvement over other web servers like Apache where you&rsquo;ve
  got no idea why one stanza has to go in a particular place, or
  why information has to be duplicated. <!--l. 69-->

  <p class="indent">With Mongrel2 it&rsquo;s all right there. 
  <!--l. 72-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">3.2</span> <a id=
  "x1-220003.2" name="x1-220003.2"></a>Trying m2sh</h3><!--l. 74-->

  <p class="noindent">To give this configuration system a try you
  just need to run the test configuration used in the unit tests.
  Let&rsquo;s try doing a few of the most basic commands with this
  configuration: <!--l. 77-->

  <p class="indent"><a id="x1-22001r5" name="x1-22001r5"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 5:</span> <span class=
      "content"><span class="pplri7t-">Sample m2sh</span>
      <span class="pplri7t-">Commands</span></span>
    </div><!--tex4ht:label?: x1-22001r5 -->

    <div class="fancyvrb" id="fancyvrb5">
      <a id="x1-22003r1" name="x1-22003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;dump</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-22005r2" name="x1-22005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;servers</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-22007r3" name="x1-22007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;hosts</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-22009r4" name="x1-22009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-22011r5" name="x1-22011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 87-->

  <p class="indent">At this point you should have seen some raw
  dumps of the database, lists of servers and hosts, seen that
  mongrel2 is not running, and then started it. You can find out
  about all the commands and get help for them with <span class=
  "pplri7t-">m2sh help</span> or <span class="pplri7t-">ms2h
  help</span> <span class="pplri7t-">-for command</span>. 
  <!--l. 91-->

  <p class="indent">You can now try doing some simple starting,
  stopping and reloading using sudo (make sure you CTRL-c to exit
  from the previous start command): <!--l. 94-->

  <p class="indent"><a id="x1-22012r6" name="x1-22012r6"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 6:</span> <span class=
      "content"><span class="pplri7t-">Starting, Stopping,</span>
      <span class="pplri7t-">Reloading</span></span>
    </div><!--tex4ht:label?: x1-22012r6 -->

    <div class="fancyvrb" id="fancyvrb6">
      <a id="x1-22014r1" name="x1-22014r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><span class=
      "pcrr7t-x-x-90">&nbsp;-sudo</span><br class="fancyvrb">
      <a id="x1-22016r2" name="x1-22016r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;tail</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs/error.log</span><br class=
      "fancyvrb">
      <a id="x1-22018r3" name="x1-22018r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;reload</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-22020r4" name="x1-22020r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;tail</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs/error.log</span><br class=
      "fancyvrb">
      <a id="x1-22022r5" name="x1-22022r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;curl</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://localhost:8080/</span><br class=
      "fancyvrb">
      <a id="x1-22024r6" name="x1-22024r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;tail</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs/error.log</span><br class=
      "fancyvrb">
      <a id="x1-22026r7" name="x1-22026r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-22028r8" name="x1-22028r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;stop</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;tests/config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 107-->

  <p class="indent">Awesome right? Using just this one little
  Python management script you are able to completely manage a
  mongrel2 instance without having to hack on a config file at all.
  But you probably need to know how this is all working anyway.

  <h4 class="subsectionHead"><span class="titlemark">3.2.1</span>
  <a id="x1-230003.2.1" name="x1-230003.2.1"></a>What The Hell Just
  Happened?</h4><!--l. 115-->

  <p class="noindent">You now have done nearly everything you can
  to a configuration, but you might not know exactly what&rsquo;s
  going on. Here&rsquo;s an explanation of what&rsquo;s going on
  behind the scenes: <!--l. 118-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-23002x1">When you did <span class=
    "pplri7t-">m2sh start</span> with the <span class=
    "pplri7t-">-sudo</span> option it actually runs <span class=
    "pplri7t-">sudo</span> <span class="pplri7t-">mongrel2
    tests/config.sqlite localhost</span> to start the server.

    <li class="enumerate" id="x1-23004x2">Mongrel2 is now running
    in the background as a daemon process, just like a regular
    server however what it did was chroot to the current directory
    and then drop privileges so that they match the owner of that
    directory (you). Use <span class="pplri7t-">ps aux</span> to
    take a look.

    <li class="enumerate" id="x1-23006x3">With Mongrel2 running you
    can look in the logs/error.log file to see what it said. It
    should be a bunch of debug logging but check out the messages,
    nice and detailed.

    <li class="enumerate" id="x1-23008x4">Next you did a soft
    reload with <span class="pplri7t-">m2sh reload</span> and you
    should notice that your mongrel2 process was able to load the
    new config <span class="pplri7t-">without restarting</span>.

    <li class="enumerate" id="x1-23010x5">However, there&rsquo;s a
    slight bug that doesn&rsquo;t do the reload until the next
    request is served, that&rsquo;s what the <span class=
    "pplri7t-">curl http://localhost:8080/</span> was for.

    <li class="enumerate" id="x1-23012x6">Now that you can see this
    reload work in the <span class="pplb7t-">logs/error.log</span>
    you used <span class="pplri7t-">m2sh running</span> to see if
    it&rsquo;s running. This command is just reading the config
    database to find out where the PID file is (<span class=
    "pplb7t-">run/mongrel2.pid</span>) and then checking if that
    process is running.

    <li class="enumerate" id="x1-23014x7">Finally, you tell
    mongrel2 to stop, and since it dropped privileges to be owned
    by you, you can do that without having to use sudo.
  </ol><!--l. 137-->

  <p class="indent">All of this is happening by reading the
  <span class="pplb7t-">tests/config.sqlite</span> file and not
  reading any configuration files. You can now try building your
  own configuration that matches this one or some others. 
  <!--l. 141-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">3.3</span> <a id=
  "x1-240003.3" name="x1-240003.3"></a>A Simple Configuration
  File</h3><!--l. 143-->

  <p class="noindent">To configure a new config database
  you&rsquo;ll write a Python file that looks a lot like a
  configuration file. The advantage of using Python is that you can
  put actual real logic in your configuration file in order to make
  your configuration smarter. A great application of this is when
  your configuration has to change depending on the server it is
  deployed on, but you want to check the configuration file into a
  revision control system. With Python you just write your
  configuration like it&rsquo;s code and you&rsquo;re set. 
  <!--l. 151-->

  <p class="indent">The first thing you need to do is initialize a
  fresh configuration database to get started by using <span class=
  "pplri7t-">m2sh init</span> and then you load your configuration
  using <span class="pplri7t-">m2sh load</span>. As an example,
  we&rsquo;ll use the example configuration from <span class=
  "pplb7t-">examples/python/tests/sample</span><span class=
  "pplb7t-">_conf.py</span> to make a simple one: <!--l. 156-->

  <p class="indent"><a id="x1-24001r7" name="x1-24001r7"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 7:</span> <span class=
      "content"><span class="pplri7t-">Simple Little Config</span>
      <span class="pplri7t-">Example</span></span>
    </div><!--tex4ht:label?: x1-24001r7 -->

    <div class="fancyvrb" id="fancyvrb7">
      <a id="x1-24003r1" name="x1-24003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;from</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2.config</span><span class=
      "pcrr7t-x-x-90">&nbsp;import</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#8902;</span><br class="fancyvrb">
      <a id="x1-24005r2" name="x1-24005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-24007r3" name="x1-24007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;main</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Server(</span><br class="fancyvrb">
      <a id="x1-24009r4" name="x1-24009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;uuid="f400bf85-4538-4f7a-8908-67e313d515c2",</span><br class="fancyvrb">
      <a id="x1-24011r5" name="x1-24011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;access_log="/logs/access.log",</span><br class="fancyvrb">
      <a id="x1-24013r6" name="x1-24013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;error_log="/logs/error.log",</span><br class="fancyvrb">
      <a id="x1-24015r7" name="x1-24015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chroot="./",</span><br class=
      "fancyvrb">
      <a id="x1-24017r8" name="x1-24017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;default_host="localhost",</span><br class="fancyvrb">
      <a id="x1-24019r9" name="x1-24019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;pid_file="/run/mongrel2.pid",</span><br class="fancyvrb">
      <a id="x1-24021r10" name="x1-24021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;port=6767,</span><br class="fancyvrb">
      <a id="x1-24023r11" name="x1-24023r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;hosts</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;</span><br class="fancyvrb">
      <a id="x1-24025r12" name="x1-24025r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Host(name="localhost",</span><span class="pcrr7t-x-x-90">&nbsp;routes={</span><br class="fancyvrb">
      <a id="x1-24027r13" name="x1-24027r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;'/tests/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;Dir(base='tests/',</span><span class=
      "pcrr7t-x-x-90">&nbsp;index_file='index.html',</span><br class="fancyvrb">
      <a id="x1-24029r14" name="x1-24029r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;default_ctype='text/plain')</span><br class="fancyvrb">
      <a id="x1-24031r15" name="x1-24031r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;})</span><br class="fancyvrb">
      <a id="x1-24033r16" name="x1-24033r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#93;</span><br class="fancyvrb">
      <a id="x1-24035r17" name="x1-24035r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;)</span><br class="fancyvrb">
      <a id="x1-24037r18" name="x1-24037r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-24039r19" name="x1-24039r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;commit(&#91;main&#93;)</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 180-->

  <p class="indent">If you aren&rsquo;t familiar with Python then
  this code might look freaky, but it&rsquo;s really simple. Well
  get into how its structured in a second, but to load this file we
  would just do this: <!--l. 184-->

  <p class="indent"><a id="x1-24040r8" name="x1-24040r8"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 8:</span> <span class=
      "content"><span class="pplri7t-">Loading The Simple</span>
      <span class="pplri7t-">Config</span></span>
    </div><!--tex4ht:label?: x1-24040r8 -->

    <div class="fancyvrb" id="fancyvrb8">
      <a id="x1-24042r1" name="x1-24042r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;init</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;simple.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-24044r2" name="x1-24044r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;load</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;simple.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-config</span><span class=
      "pcrr7t-x-x-90">&nbsp;examples/python/tests/sample_conf.py</span><br class="fancyvrb">
      <a id="x1-24046r3" name="x1-24046r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;servers</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;simple.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-24048r4" name="x1-24048r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;hosts</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;simple.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-24050r5" name="x1-24050r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;simple.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 194-->

  <p class="indent">With this sequence of commands you:

  <ol class="enumerate1">
    <li class="enumerate" id="x1-24052x1">Create a raw fresh config
    database name <span class="pplb7t-">simple.sqlite</span>

    <li class="enumerate" id="x1-24054x2">Load the <span class=
    "pplb7t-">sample</span><span class="pplb7t-">_conf.py</span>
    into it.

    <li class="enumerate" id="x1-24056x3">List the servers it has
    configured.

    <li class="enumerate" id="x1-24058x4">List the hosts that
    server has, with what routes it has.

    <li class="enumerate" id="x1-24060x5">Start this server to try
    it out.
  </ol><!--l. 204-->

  <p class="indent">By now you should be getting the hang of the
  pattern here, which is to use m2sh and little Python
  configuration &rdquo;script&rdquo; to generate .sqlite files that
  Mongrel2 understands.

  <h3 class="sectionHead"><span class="titlemark">3.4</span> <a id=
  "x1-250003.4" name="x1-250003.4"></a>How A Config Is
  Structured</h3><!--l. 210-->

  <p class="noindent">The base structure of a Mongrel2
  configuration is:

  <dl class="description">
    <dt class="description"><span class="pplb7t-">Server</span>

    <dd class="description">This is the root of a config, and you
    can have multiples of these in one database, even though each
    start command only runs one at a time.

    <dt class="description"><span class="pplb7t-">Host</span>

    <dd class="description">Servers then have Hosts inside them
    which say what DNS hostname Mongrel2 should answer for, and you
    can have multiples of these in each Server.

    <dt class="description"><span class="pplb7t-">Route</span>

    <dd class="description">Hosts have Routes in them which tells
    Mongrel2 what to do with URL paths and patterns that match
    them. Routes then have <span class="pplri7t-">Dir</span>,
    <span class="pplri7t-">Handler</span>, and <span class=
    "pplri7t-">Proxy</span> items in them.

    <dt class="description"><span class="pplb7t-">Dir</span>

    <dd class="description">A Dir serves files out of a directory,
    full with 304 and ETag support, default content types, and most
    of the things you need to serve them.

    <dt class="description"><span class="pplb7t-">Proxy</span>

    <dd class="description">A Proxy takes requests matching the
    Route they&rsquo;re attached to and sends them to another HTTP
    server somewhere else. Mongrel2 will then act as a full proxy
    and also try to keep connections open in keep-alive mode if the
    browser supports it.

    <dt class="description"><span class="pplb7t-">Handler</span>

    <dd class="description">A Handler is the best part of Mongrel2.
    It takes HTTP requests, and turns them into nicely packed and
    processed ZeroMQ messages for your asynchronous handlers.
  </dl><!--l. 228-->

  <p class="indent">Each of these nested &rdquo;objects&rdquo; then
  has a set of attributes you can use to configure them, and most
  of them have reasonable defaults. <!--l. 232-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.1</span>
  <a id="x1-260003.4.1" name="x1-260003.4.1"></a>Server</h4>
  <!--l. 234-->

  <p class="noindent">The server is all about telling Mongrel2
  where to listen on its port, where to chroot, and general server
  specific deployment gear.

  <dl class="description">
    <dt class="description"><span class="pplb7t-">uuid</span>

    <dd class="description">A UUID is used to make sure that each
    deployed server is unique in your infrastructure. You could
    easily use any string that&rsquo;s letters, numbers, or -
    characters.

    <dt class="description"><span class="pplb7t-">chroot</span>

    <dd class="description">This is the directory that Mongrel2
    should chroot to and drop privileges.

    <dt class="description"><span class=
    "pplb7t-">access</span><span class="pplb7t-">_log</span>

    <dd class="description">The access log file <span class=
    "pplri7t-">relative to the chroot</span>. Usually starts with a
    &rsquo;/&rsquo;. Make sure you don&rsquo;t configure your
    server so that this and other files are accessible, or make
    this owned by root.

    <dt class="description"><span class=
    "pplb7t-">error</span><span class="pplb7t-">_log</span>

    <dd class="description">The error log file just like
    access_log.

    <dt class="description"><span class=
    "pplb7t-">pid</span><span class="pplb7t-">_file</span>

    <dd class="description">Like the access log, where within the
    chroot directory is the pid file stored.

    <dt class="description"><span class=
    "pplb7t-">default</span><span class="pplb7t-">_host</span>

    <dd class="description">The server has a bunch of hosts listed,
    but it needs to know what the default host is. This is also
    used as a convenient way to refer to this Server.

    <dt class="description"><span class="pplb7t-">port</span>

    <dd class="description">The port the server should listen on
    for new connections.
  </dl><!--l. 251-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.2</span>
  <a id="x1-270003.4.2" name="x1-270003.4.2"></a>Host</h4>
  <!--l. 253-->

  <p class="noindent">A host is matched using a kind of
  <span class="pplri7t-">inverse route</span> that matches the
  ending of <span class="pplri7t-">Host:</span> headers against a
  pattern. You&rsquo;ll see how this works when we talk about
  routes, but for now you just need to know that request to the
  <span class="pplri7t-">Server.port</span> are routed based on
  these <span class="pplri7t-">Host</span> configurations the
  <span class="pplri7t-">Server</span> contains.

  <dl class="description">
    <dt class="description"><span class="pplb7t-">name</span>

    <dd class="description">The name that you use to talk about
    this Host in the server configuration.

    <dt class="description"><span class="pplb7t-">matching</span>

    <dd class="description">This is a pattern that&rsquo;s used to
    match incoming Host headers for routing purposes.

    <dt class="description"><span class="pplb7t-">server</span>

    <dd class="description">If you want to set the server
    separately you can use this attribute.

    <dt class="description"><span class=
    "pplb7t-">maintenance</span>

    <dd class="description">This will a setting for the future that
    will let you have Mongrel2 throw up a maintenance page for this
    host.

    <dt class="description"><span class="pplb7t-">routes</span>

    <dd class="description">This is a dict (hashmap) of the URL
    patterns mapped to the targets that should be run.
  </dl><!--l. 268-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.3</span>
  <a id="x1-280003.4.3" name="x1-280003.4.3"></a>Route</h4>
  <!--l. 270-->

  <p class="noindent">The <span class="pplri7t-">Route</span> is
  the workhorse of the whole system. It uses some very fancy but
  still simple code in Mongrel2 to translate <span class=
  "pplri7t-">Host:</span> headers to <span class=
  "pplri7t-">Hosts</span> and URL paths to <span class=
  "pplri7t-">Handlers</span>, <span class="pplri7t-">Dirs</span>,
  and <span class="pplri7t-">Proxies</span>.

  <dl class="description">
    <dt class="description"><span class="pplb7t-">path</span>

    <dd class="description">This is path <span class=
    "pplri7t-">pattern</span> that matches a route. The pattern
    uses the Mongrel2 pattern langauge which is a reduced version
    of the Lua pattern matching system.

    <dt class="description"><span class="pplb7t-">reversed</span>

    <dd class="description">Determines if this pattern is reversed,
    which is useful for matching file extensions, hostnames, and
    other naming systems where the ending is really the prefix.
    Usually you don&rsquo;t set this.

    <dt class="description"><span class="pplb7t-">host</span>

    <dd class="description">If you want to set the host manually
    then you can use this attribute.

    <dt class="description"><span class="pplb7t-">target</span>

    <dd class="description">This is the target that should handle
    the request, either a <span class="pplri7t-">Dir</span>,
    <span class="pplri7t-">Handler</span>, <span class=
    "pplri7t-">Proxy</span>.
  </dl><!--l. 283-->

  <p class="indent">Later on you&rsquo;ll learn about the pattern
  matching that&rsquo;s used, but it&rsquo;s basically a stripped
  down version of your normal regular expressions, but with a few
  convenient syntaxes for doing simple string matching. When you
  configure a route you write something like <span class=
  "pplb7t-">/images/(.*.jpg)</span> and the part before the
  &rsquo;(&rsquo; is used as a fast matched prefix while the part
  after is considered a pattern to match. When a request comes in,
  Mongrel2 quickly finds the longest prefix that matches the URL,
  and then tests its pattern if there is one. If the pattern is
  valid then the request goes through. If not then 404. 
  <!--l. 291-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.4</span>
  <a id="x1-290003.4.4" name="x1-290003.4.4"></a>Dir</h4>
  <!--l. 293-->

  <p class="noindent">A <span class="pplri7t-">Dir</span> is a
  simple directory serving route target that serves files out of a
  directory. It has caching built-in, handles if-modified-since,
  etags, and all the various bizarre HTTP caching mechanisms as RFC
  accurate as possible. It also has default content types and index
  files.

  <dl class="description">
    <dt class="description"><span class="pplb7t-">base</span>

    <dd class="description">This is the base directory <span class=
    "pplri7t-">from the chroot</span> that is served. Files should
    not be served outside of this base directory even in the
    chroot.

    <dt class="description"><span class=
    "pplb7t-">index</span><span class="pplb7t-">_file</span>

    <dd class="description">This is the default index file to use
    if a request doesn&rsquo;t give one. The <span class=
    "pplri7t-">Dir</span> also will do redirects if a request for a
    directory doesn&rsquo;t end in a / slash.

    <dt class="description"><span class=
    "pplb7t-">default</span><span class="pplb7t-">_ctype</span>

    <dd class="description">The default Content-Type to use if none
    matches the MIMEType table.
  </dl><!--l. 305-->

  <p class="indent">Currently we don&rsquo;t offer more parameters
  for configuration, but eventually you&rsquo;ll be able to tweak
  more and more of the settings to control out Dirs work. 
  <!--l. 308-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.5</span>
  <a id="x1-300003.4.5" name="x1-300003.4.5"></a>Proxy</h4>
  <!--l. 310-->

  <p class="noindent">A Proxy is a Ghetto. It is used so that you
  can use Mongrel2 but not have to throw out your existing
  infrastructure. Mongrel2 goes to great pains to make sure that it
  implements a fast and dead accurate proxy system internally, but
  no matter how good it is it can&rsquo;t compete with ZeroMQ
  handlers. The idea with giving Proxy functionality is you can
  point Mongrel2 at existing servers, and then slowly carve out
  pieces that will work as handlers.

  <dl class="description">
    <dt class="description"><span class="pplb7t-">addr</span>

    <dd class="description">The DNS address of the server.

    <dt class="description"><span class="pplb7t-">port</span>

    <dd class="description">The port to connect to.
  </dl><!--l. 323-->

  <p class="indent">Requests that match a Proxy route are still
  parsed by Mongrel2&rsquo;s incredibly accurate HTTP parser so
  that your backend servers should not be receiving badly formatted
  HTTP requests. Responses from a Proxy server however are sent
  unaltered to the browser directly. <!--l. 329-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.6</span>
  <a id="x1-310003.4.6" name="x1-310003.4.6"></a>Handler</h4>
  <!--l. 331-->

  <p class="noindent">Now we get to the best part, the ZeroMQ
  <span class="pplri7t-">Handlers</span> that will receive
  asynchronous requests from Mongrel2. You need to use the ZeroMQ
  syntax for configuring them, but this means with one
  configuration format you can use handlers that are using udp,
  tcp, unix, or pgm transports. Most testing has been done with tcp
  transports the most.

  <dl class="description">
    <dt class="description"><span class=
    "pplb7t-">send</span><span class="pplb7t-">_spec</span>

    <dd class="description">This is the 0MQ sender specification,
    something like &rdquo;tcp://127.0.0.1:9999&rdquo; will use tcp
    to connect to a server on 127.0.0.1 at port 9999. The type of
    socket used is a DOWNSTREAM socket so that handlers receive
    messages in round-robin style.

    <dt class="description"><span class=
    "pplb7t-">send</span><span class="pplb7t-">_ident</span>

    <dd class="description">This is an identifier (usually a UUID)
    that will be used to register the send socket. Doing this makes
    it so that messages are persisted between crashes.

    <dt class="description"><span class=
    "pplb7t-">recv</span><span class="pplb7t-">_spec</span>

    <dd class="description">Same as the send spec, but it&rsquo;s
    for receiving responses from Handlers. The type of socket used
    is a SUB socket so that a cluster of Mongrel2 servers will
    receive handler responses but only the one with the right
    recv_ident will process it.

    <dt class="description"><span class=
    "pplb7t-">recv</span><span class="pplb7t-">_ident</span>

    <dd class="description">This is another UUID if you want the
    receive socket to subscribe to its messages. Handlers properly
    mention the send_ident on all returned messages, so you should
    either set this to nothing and don&rsquo;t subscribe, or set it
    to the same as send_ident.
  </dl><!--l. 350-->

  <p class="indent">The interesting thing about the <span class=
  "pplri7t-">Handler</span> configuration is you don&rsquo;t have
  to say where the actual backend handlers live. Notice you
  aren&rsquo;t declaring large clusters of proxies, proxy selection
  methods, or anything else other than two 0MQ endpoints and some
  identifiers? This is because Mongrel2 is <span class=
  "pplri7t-">binding</span> these sockets and listening. Mongrel2
  doesn&rsquo;t actively connect to backends, they connect to
  Mongrel2. This means if you want to fire up 10 more handlers, you
  just start them. No need to restart or reconfigure Mongrel2 to
  make them active. <!--l. 358-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">3.4.7</span>
  <a id="x1-320003.4.7" name="x1-320003.4.7"></a>Others</h4>
  <!--l. 360-->

  <p class="noindent">There&rsquo;s also <span class=
  "pplri7t-">Log</span>, <span class="pplri7t-">MIMEType</span>,
  and <span class="pplri7t-">Setting</span> objects/tables you can
  work with, but we&rsquo;ll get into those later since you
  don&rsquo;t need to know about them to understand the Mongrel2
  structure. <!--l. 366-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">3.5</span> <a id=
  "x1-330003.5" name="x1-330003.5"></a>A More Complex Example</h3>
  <!--l. 368-->

  <p class="noindent">All of this knowledge about the Mongrel2
  configuration structure can now be used to take a look at a more
  complex example. What we&rsquo;ll do is take a look at this
  example and I&rsquo;ll just say what&rsquo;s going on, and you
  try to match what I&rsquo;m saying to the code. Here&rsquo;s the
  file <span class=
  "pplb7t-">examples/python/tests/mongrel2</span><span class=
  "pplb7t-">_org.py</span>: <!--l. 372-->

  <p class="indent"><a id="x1-33001r9" name="x1-33001r9"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 9:</span> <span class=
      "content"><span class="pplri7t-">Mongrel2.org Config</span>
      <span class="pplri7t-">Script</span></span>
    </div><!--tex4ht:label?: x1-33001r9 -->

    <div class="fancyvrb" id="fancyvrb9">
      <a id="x1-33003r1" name="x1-33003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;from</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2.config</span><span class=
      "pcrr7t-x-x-90">&nbsp;import</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#8902;</span><br class="fancyvrb">
      <a id="x1-33005r2" name="x1-33005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33007r3" name="x1-33007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;main</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Server(</span><br class="fancyvrb">
      <a id="x1-33009r4" name="x1-33009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;uuid="2f62bd5-9e59-49cd-993c-3b6013c28f05",</span><br class="fancyvrb">
      <a id="x1-33011r5" name="x1-33011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;access_log="/logs/access.log",</span><br class="fancyvrb">
      <a id="x1-33013r6" name="x1-33013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;error_log="/logs/error.log",</span><br class="fancyvrb">
      <a id="x1-33015r7" name="x1-33015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chroot="./",</span><br class=
      "fancyvrb">
      <a id="x1-33017r8" name="x1-33017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;pid_file="/run/mongrel2.pid",</span><br class="fancyvrb">
      <a id="x1-33019r9" name="x1-33019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;default_host="mongrel2.org",</span><br class="fancyvrb">
      <a id="x1-33021r10" name="x1-33021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;port=6767</span><br class="fancyvrb">
      <a id="x1-33023r11" name="x1-33023r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;)</span><br class="fancyvrb">
      <a id="x1-33025r12" name="x1-33025r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33027r13" name="x1-33027r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33029r14" name="x1-33029r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;test_directory</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Dir(base='tests/',</span><br class=
      "fancyvrb">
      <a id="x1-33031r15" name="x1-33031r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;index_file='index.html',</span><br class="fancyvrb">
      <a id="x1-33033r16" name="x1-33033r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;default_ctype='text/plain')</span><br class="fancyvrb">
      <a id="x1-33035r17" name="x1-33035r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33037r18" name="x1-33037r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;web_app_proxy</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Proxy(addr='127.0.0.1',</span><span class="pcrr7t-x-x-90">&nbsp;port=80)</span><br class="fancyvrb">
      <a id="x1-33039r19" name="x1-33039r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33041r20" name="x1-33041r20"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat_demo_dir</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Dir(base='examples/chat/static/',</span><br class="fancyvrb">
      <a id="x1-33043r21" name="x1-33043r21"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;index_file='index.html',</span><br class="fancyvrb">
      <a id="x1-33045r22" name="x1-33045r22"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;default_ctype='text/plain')</span><br class="fancyvrb">
      <a id="x1-33047r23" name="x1-33047r23"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33049r24" name="x1-33049r24"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat_demo</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Handler(send_spec='tcp://127.0.0.1:9999',</span><br class="fancyvrb">
      <a id="x1-33051r25" name="x1-33051r25"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;send_ident='54c6755b-9628-40a4-9a2d-cc82a816345e',</span><br class="fancyvrb">
      <a id="x1-33053r26" name="x1-33053r26"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;recv_spec='tcp://127.0.0.1:9998',</span><span class="pcrr7t-x-x-90">&nbsp;recv_ident='')</span><br class="fancyvrb">
      <a id="x1-33055r27" name="x1-33055r27"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33057r28" name="x1-33057r28"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;handler_test</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Handler(send_spec='tcp://127.0.0.1:9997',</span><br class="fancyvrb">
      <a id="x1-33059r29" name="x1-33059r29"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;send_ident='34f9ceee-cd52-4b7f-b197-88bf2f0ec378',</span><br class="fancyvrb">
      <a id="x1-33061r30" name="x1-33061r30"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;recv_spec='tcp://127.0.0.1:9996',</span><span class="pcrr7t-x-x-90">&nbsp;recv_ident='')</span><br class="fancyvrb">
      <a id="x1-33063r31" name="x1-33063r31"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33065r32" name="x1-33065r32"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;r''</span><span class=
      "pcrr7t-x-x-90">&nbsp;string</span><span class=
      "pcrr7t-x-x-90">&nbsp;syntax</span><span class=
      "pcrr7t-x-x-90">&nbsp;means</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;not</span><span class=
      "pcrr7t-x-x-90">&nbsp;interpret</span><span class=
      "pcrr7t-x-x-90">&nbsp;any</span><span class=
      "pcrr7t-x-x-90">&nbsp;\</span><span class=
      "pcrr7t-x-x-90">&nbsp;chars,</span><span class=
      "pcrr7t-x-x-90">&nbsp;for</span><span class=
      "pcrr7t-x-x-90">&nbsp;regexes</span><br class="fancyvrb">
      <a id="x1-33067r33" name="x1-33067r33"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;Host(name="mongrel2.org",</span><span class="pcrr7t-x-x-90">&nbsp;routes={</span><br class="fancyvrb">
      <a id="x1-33069r34" name="x1-33069r34"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'@chat':</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat_demo,</span><br class="fancyvrb">
      <a id="x1-33071r35" name="x1-33071r35"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/handlertest':</span><span class=
      "pcrr7t-x-x-90">&nbsp;handler_test,</span><br class=
      "fancyvrb">
      <a id="x1-33073r36" name="x1-33073r36"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/chat/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;web_app_proxy,</span><br class=
      "fancyvrb">
      <a id="x1-33075r37" name="x1-33075r37"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;web_app_proxy,</span><br class=
      "fancyvrb">
      <a id="x1-33077r38" name="x1-33077r38"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/tests/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;test_directory,</span><br class=
      "fancyvrb">
      <a id="x1-33079r39" name="x1-33079r39"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/testsmulti/(.&#8902;.json)':</span><span class="pcrr7t-x-x-90">&nbsp;test_directory,</span><br class="fancyvrb">
      <a id="x1-33081r40" name="x1-33081r40"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/chatdemo/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat_demo_dir,</span><br class=
      "fancyvrb">
      <a id="x1-33083r41" name="x1-33083r41"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/static/':</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat_demo_dir,</span><br class=
      "fancyvrb">
      <a id="x1-33085r42" name="x1-33085r42"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;r'/mp3stream':</span><span class=
      "pcrr7t-x-x-90">&nbsp;Handler(</span><br class="fancyvrb">
      <a id="x1-33087r43" name="x1-33087r43"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;send_spec='tcp://127.0.0.1:9995',</span><br class="fancyvrb">
      <a id="x1-33089r44" name="x1-33089r44"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;send_ident='53f9f1d1-1116-4751-b6ff-4fbe3e43d142',</span><br class="fancyvrb">
      <a id="x1-33091r45" name="x1-33091r45"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;recv_spec='tcp://127.0.0.1:9994',</span><span class="pcrr7t-x-x-90">&nbsp;recv_ident='')</span><br class="fancyvrb">
      <a id="x1-33093r46" name="x1-33093r46"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;})</span><br class="fancyvrb">
      <a id="x1-33095r47" name="x1-33095r47"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33097r48" name="x1-33097r48"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;main.hosts</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;mongrel2&#93;</span><br class="fancyvrb">
      <a id="x1-33099r49" name="x1-33099r49"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33101r50" name="x1-33101r50"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;settings</span><span class=
      "pcrr7t-x-x-90">&nbsp;=</span><span class=
      "pcrr7t-x-x-90">&nbsp;{"zeromq.threads":</span><span class=
      "pcrr7t-x-x-90">&nbsp;4}</span><br class="fancyvrb">
      <a id="x1-33103r51" name="x1-33103r51"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-33105r52" name="x1-33105r52"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;commit(&#91;main&#93;,</span><span class=
      "pcrr7t-x-x-90">&nbsp;settings=settings)</span><br class=
      "fancyvrb">
      <a id="x1-33107r53" name="x1-33107r53"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 430-->

  <p class="indent">If you haven&rsquo;t guessed yet, this
  configuration is what&rsquo;s used on <a href=
  "http://mongrel2.org" class="url"><span class=
  "pcrr7t-">http://mongrel2.org</span></a> to configure the main
  test system. In it we&rsquo;ve got the following things to check
  out:

  <ol class="enumerate1">
    <li class="enumerate" id="x1-33109x1">Our basic server with a
    default host of mongrel2.org.

    <li class="enumerate" id="x1-33111x2">The route targets are
    separated out into their own variables, unlike the <span class=
    "pplb7t-">sample</span><span class="pplb7t-">_conf.py</span>
    file where they&rsquo;re just tossed into one big structure.

    <li class="enumerate" id="x1-33113x3">First target is a
    <span class="pplri7t-">Dir</span> that serves up files out of
    the <span class="pplb7t-">tests</span> directory and uses
    <span class="pplb7t-">index.html</span> as its default file.

    <li class="enumerate" id="x1-33115x4">Next we setup a
    <span class="pplri7t-">Proxy</span> pointing at the main
    website&rsquo;s server for testing the proxy.

    <li class="enumerate" id="x1-33117x5">Then there&rsquo;s a
    <span class="pplri7t-">Dir</span> target for the <a href=
    "http://mongrel2.org:6767/chatdemo/" class="url"><span class=
    "pcrr7t-">http://mongrel2.org:6767/chatdemo/</span></a> that
    we&rsquo;ll look at later.

    <li class="enumerate" id="x1-33119x6">And you have the
    <span class="pplri7t-">Handler</span> for the same chat demo
    that does the actual logic of a chat system.

    <li class="enumerate" id="x1-33121x7">After that&rsquo;s a
    little <span class="pplri7t-">Handler</span> for testing out
    doing HTTP requests to a handler. Notice how even though the
    chat demo and this handler use different protocols (chat demo
    is using JSSockets) you don&rsquo;t have tell mongrel2 that? It
    figures it out based on how they&rsquo;re being used rather
    than by configurations.

    <li class="enumerate" id="x1-33123x8">With all those handler
    targets we can now make the <span class="pplri7t-">mongrel2
    Host</span> with all the routes assigned once and nice and
    clean. However look how I was lazy and just tossed the
    mp3stream demo right into the routes dict? You can totally do
    this and m2sh will figure it out. Remember also that you can
    use the <span class="obeylines-h verb pcrr7t-">r'blah'</span>
    string format to not have to double up on your <span class=
    "obeylines-h verb pcrr7t-">\</span> chars in the patterns.

    <li class="enumerate" id="x1-33125x9">We then assign this
    <span class="pplri7t-">mongrel2</span> variable as the hosts
    for the <span class="pplri7t-">main</span> server.

    <li class="enumerate" id="x1-33127x10">There is also a settings
    feature which is just a dict of global settings you can tweak.
    In this case we&rsquo;re upping the number of threads that 0MQ
    is using for doing it&rsquo;s operations.

    <li class="enumerate" id="x1-33129x11">Finally, we commit the
    whole thing to the database by passing in the servers to save
    and the settings to use.
  </ol><!--l. 456-->

  <p class="indent">And that my friends is the most complex
  configuration we have so far.

  <h3 class="sectionHead"><span class="titlemark">3.6</span> <a id=
  "x1-340003.6" name="x1-340003.6"></a>Routing And Host
  Patterns</h3><!--l. 461-->

  <p class="noindent">The pattern code was taken from <a href=
  "http://www.lua.org/">Lua</a> and is some of the simplest code
  for doing fast pattern matches. It is very much like regular
  expressions except it removes a lot of features you don&rsquo;t
  need for routes. How Mongrel2 to uses them is it takes routes and
  breaks them into a prefix and pattern part. It then uses routes
  to find the longest matching prefix and then tests the pattern.
  If the pattern matches then the route works. If the route
  doesn&rsquo;t have a pattern then it&rsquo;s assumed to match and
  you&rsquo;re done. <!--l. 468-->

  <p class="indent">The only caveat is you have to wrap your
  pattern parts in parenthesis, but these don&rsquo;t mean anything
  other than to delimit where a pattern starts. So instead of
  <span class="pplri7t-">/images/.*.jpg</span> write <span class=
  "pplri7t-">/images/(.*.jpg)</span> for it to work right. 
  <!--l. 472-->

  <p class="indent">Here&rsquo;s the list of characters you can use
  in your patterns:

  <ul class="itemize1">
    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">.</span> (period) all characters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\a</span> Letters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\c</span> Control characters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\d</span> Digits.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\l</span> Lowercase letters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\p</span> Punctuation characters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\s</span> Space characters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\u</span> Uppercase letters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\w</span> Alphanumeric characters.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\x</span> Hexadecimal digits.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\z</span> The 0 character (null
    terminator).

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\x</span> Escapes x, so <span class=
    "obeylines-h verb pcrr7t-">\</span> escapes <span class=
    "obeylines-h verb pcrr7t-">\</span>, <span class=
    "obeylines-h verb pcrr7t-">\</span>* escapes *.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">&#91;set&#93;</span> Just like a regex &#91;&#93;
    where it is a class of chars, like &#91;0-9&#93; for all digits.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">&#91;^set&#93;</span> Inverse character set,
    so &#91;<img src="book-final0x.png" alt="^ 0 " class="circ">-9&#93; is
    anything not digits.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">x&#8902;</span> Longest match of 0
    or more x chars.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">x+</span> Longest match of 1 or more
    x chars.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">x-</span> Shortest match of 0 or
    more x chars.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">x?</span> 0 or 1 match of x char.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">\bxy</span> Balanced match a
    substring starting with x and ending in y. So <span class=
    "obeylines-h verb pcrr7t-">\</span>b() will match balanced
    parenthesis.

    <li class="itemize"><span class=
    "obeylines-h verb pcrr7t-">^</span> The beginning of a string.

    <li class="itemize">$ End of the string.
  </ul><!--l. 498-->

  <p class="indent">Anything that&rsquo;s not listed here just
  matches that character. Remember also that when you write the
  Python code for your scripts you can use the <span class=
  "obeylines-h verb pcrr7t-">r'blah'</span> string syntax to avoid
  having to double up on your <span class=
  "obeylines-h verb pcrr7t-">\</span> characters in the string. 
  <!--l. 502-->

  <p class="indent"><a id="x1-34001r3" name="x1-34001r3"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 3:</span> <span class=
      "content"><span class="pplri7t-">Sorry Unicodians, It&rsquo;s
      All</span> <span class="pplri7t-">ASCII</span></span>
    </div><!--tex4ht:label?: x1-34001r3 -->

    <div class="quote">
      <!--l. 503-->

      <p class="noindent">Yep, I get it. You think that everyone
      should use UTF-8 or some Unicode encoding for everything. You
      despise the dominance of the &rsquo;A&rsquo; in ASCII and
      hate that you can&rsquo;t put your spoken language right in a
      URL. <!--l. 507-->

      <p class="noindent">Well, I hate to say it, but tough.
      Protocols are hard enough without having to worry about the
      bewildering mess that is Unicode. When you sit down to write
      a network protocol, the last thing you need is a format
      that&rsquo;s inconsistent, has multiple interpretations,
      can&rsquo;t be properly capitalized or lowercased, and
      requires extra translations steps for every operation. With
      ASCII every computer just knows what it is and it&rsquo;s the
      fastest for creating wire protocol formats. <!--l. 515-->

      <p class="noindent">This is why, on the internet, you have to
      do things to URLs to make them ASCII like encoding them with
      % signs. It&rsquo;s in the standard and it&rsquo;s the smart
      thing to do. I don&rsquo;t want to have to know the
      difference between the various accents in your spoken
      language to route a URL around. I just want to deal with a
      fixed set of characters and be done with it. Don&rsquo;t
      blame me or Mongrel2 for this, it&rsquo;s just the way the
      standard is and the way to get a server that is stable and
      works. <!--l. 523-->

      <p class="noindent">Protocols work better when there&rsquo;s
      less politics in their design. This means you can&rsquo;t put
      Unicode into your URL patterns. I mean you can try but the
      behavior is completely undefined.
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 530-->

  <p class="indent">Here&rsquo;s some example routes you can try to
  get a feel for the system:

  <ul class="itemize1">
    <li class="itemize">r&rdquo;<span class=
    "obeylines-h verb pcrr7t-">/images/</span>&rdquo; This will
    just match any path that has /images/ in it without any
    patterns.

    <li class="itemize">r&rdquo;<span class=
    "obeylines-h verb pcrr7t-">/</span>&rdquo; The fastest possible
    route you can have.

    <li class="itemize">r&rdquo;<span class=
    "obeylines-h verb pcrr7t-">/images/(.&#8902;.jpg)</span>&rdquo;
    Match only requests for jpg images in the images directory.
    Keep in mind that this isn&rsquo;t actually looking in the
    directory, it&rsquo;s just matching the <span class=
    "pplri7t-">(.*.jpg)</span> pattern.

    <li class="itemize">r&rdquo;<span class=
    "obeylines-h verb pcrr7t-">/images/(\a-\-\d+\.jpg)</span>&rdquo;
    A more complex example that matches a short sequence of 0 or
    more letters (remember -), then a dash (<span class=
    "obeylines-h verb pcrr7t-">\-</span> escapes the -), then 1 or
    long sequence of digits and finally a .jpg) with the
    <span class="obeylines-h verb pcrr7t-">\</span>. escaping the
    period.
  </ul><!--l. 541-->

  <p class="indent">That should give the idea of how you can use
  them. Notice also that I&rsquo;m using the Python <span class=
  "obeylines-h verb pcrr7t-">r"blah"</span> string syntax which is
  interchangeable with the <span class=
  "obeylines-h verb pcrr7t-">r'blah'</span> syntax so I don&rsquo;t
  have to double escape everything.

  <h3 class="sectionHead"><span class="titlemark">3.7</span> <a id=
  "x1-350003.7" name="x1-350003.7"></a>Deployment Logs And
  Commits</h3><!--l. 547-->

  <p class="noindent">A very nice feature for people doing
  operations work is that m2sh keeps track of all the commands you
  run on it while you work, and lets you add little commit logs to
  the log for documentation later. These commit logs are then
  maintained even across <span class="pplri7t-">m2sh init</span>
  and <span class="pplri7t-">m2sh load</span> commands so you can
  see what&rsquo;s going on. They track who did something, what
  server they did it on, what time they did it, and what they did. 
  <!--l. 554-->

  <p class="indent">To see the logs for your own tests just do
  <span class="pplri7t-">m2sh log -db simple.sqlite</span> and then
  if you want to add a commit log message you use the <span class=
  "pplri7t-">m2sh commit</span> command. Here&rsquo;s an example
  from mongrel2.org: <!--l. 558-->

  <p class="indent"><a id="x1-35001r10" name="x1-35001r10"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 10:</span> <span class=
      "content"><span class="pplri7t-">Example Commit</span>
      <span class="pplri7t-">Log</span></span>
    </div><!--tex4ht:label?: x1-35001r10 -->

    <div class="fancyvrb" id="fancyvrb10">
      <a id="x1-35003r1" name="x1-35003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;log</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-35005r2" name="x1-35005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T04:14:53,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;init_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;init</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><br class="fancyvrb">
      <a id="x1-35007r3" name="x1-35007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T04:15:06,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;load_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;load</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35009r4" name="x1-35009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T04:22:06,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;load_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;load</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35011r5" name="x1-35011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T04:23:32,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;load_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;load</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35013r6" name="x1-35013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T04:26:16,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;upgrade&#93;</span><span class="pcrr7t-x-x-90">&nbsp;Latest</span><span class="pcrr7t-x-x-90">&nbsp;code</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;Mongrel2.</span><br class="fancyvrb">
      <a id="x1-35015r7" name="x1-35015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T18:05:59,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;load_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;load</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35017r8" name="x1-35017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T20:09:01,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;init_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;config</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35019r9" name="x1-35019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&#91;2010-07-18T20:09:02,</span><span class="pcrr7t-x-x-90">&nbsp;mongrel2@zedshaw,</span><span class="pcrr7t-x-x-90">&nbsp;load_command&#93;</span><span class="pcrr7t-x-x-90">&nbsp;/usr/bin/m2sh</span><span class="pcrr7t-x-x-90">&nbsp;config</span><span class="pcrr7t-x-x-90">&nbsp;-db</span><span class="pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class="pcrr7t-x-x-90">&nbsp;-config</span><span class="pcrr7t-x-x-90">&nbsp;examples/python/tests/mongrel2_org.py</span><br class="fancyvrb">
      <a id="x1-35021r10" name="x1-35021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;commit</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-what</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2.org</span><span class=
      "pcrr7t-x-x-90">&nbsp;-why</span><span class=
      "pcrr7t-x-x-90">&nbsp;"Testing</span><span class=
      "pcrr7t-x-x-90">&nbsp;things</span><span class=
      "pcrr7t-x-x-90">&nbsp;out."</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 573-->

  <p class="indent">The motivation for this feature is the trend
  that operations store server configurations in revision control
  systems like git or etckeeper. This works great for holding the
  configuration files, but it doesn&rsquo;t tell you what happened
  on each server. In many cases the configuration files also need
  to be reworked or altered for each deployment. With the m2sh log
  and commits system you can augment your revision control with
  deployment action tracking. <!--l. 579-->

  <p class="indent">Later versions of Mongrel2 will keep small
  amounts of statistics which will link these actions to changes in
  Mongrel2 behavior like frequent crashing, failures, slowness, or
  other problems. <!--l. 582-->

  <p class="indent">Basically, there&rsquo;s nowhere to hide.
  Mongrel2 will help operations figure out who needs to get fired
  the next time Twitter goes down. <!--l. 1-->

  <p class="indent">

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;4</span><br>
  <a id="x1-360004" name="x1-360004"></a>Deploying</h2><!--l. 3-->

  <p class="noindent">I am now going to try to get you to setup a
  small tiny little version of a good deployment that matches the
  <a href="http://mongrel2.org" class="url"><span class=
  "pcrr7t-">http://mongrel2.org</span></a> site&rsquo;s
  configuration with all the examples running. This configuration
  will give you all the tools you need to make automated and
  managed deployments, but it is using small scale tools. The idea
  is that you learn what is involved in a nice easy to manage setup
  using simple things first, then you can extrapolate that out into
  your own setup or something better.

  <h3 class="sectionHead"><span class="titlemark">4.1</span> <a id=
  "x1-370004.1" name="x1-370004.1"></a>Mongrel2 Deployment
  Requirements</h3><!--l. 14-->

  <p class="noindent">It may seem obvious but I&rsquo;ll go over
  the things you need in order to continue on in this section:

  <dl class="description">
    <dt class="description"><span class="pplb7t-">Mongrel2</span>

    <dd class="description">I know, hard to believe, but you
    actually need to have Mongrel2 installed.

    <dt class="description"><span class="pplb7t-">m2sh</span>

    <dd class="description">Again, not sure why but some folks
    think they don&rsquo;t need this. Unless you&rsquo;ve got your
    own written you need <span class="pplri7t-">m2sh</span>.

    <dt class="description"><span class="pplb7t-">Python</span>

    <dd class="description">Obviously if you have <span class=
    "pplri7t-">m2sh</span> then you have Python, but some systems
    (like Debian) don&rsquo;t install all of Python. Make sure your
    Python setup is good.

    <dt class="description"><span class="pplb7t-">root</span>

    <dd class="description">You&rsquo;ll need root access on your
    box. Either through sudo or some other means.

    <dt class="description"><span class="pplb7t-">Basic Python
    Coding</span>

    <dd class="description">Right now you should be able to do some
    basic Python.
  </dl><!--l. 27-->

  <p class="indent">That will get you going at first, and as we go
  we&rsquo;ll do various other setups to get our application
  working. <!--l. 30-->

  <p class="indent"><a id="x1-37001r4" name="x1-37001r4"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 4:</span> <span class=
      "content"><span class="pplri7t-">Learning</span> <span class=
      "pplri7t-">Python</span></span>
    </div><!--tex4ht:label?: x1-37001r4 -->

    <div class="quote">
      <!--l. 31-->

      <p class="noindent">Why should you learn programming? The
      trend is that if you are a system administrator who
      can&rsquo;t code then you are on your way out. Eventually
      you&rsquo;ll be in charge of automating systems not manually
      managing them, and if you don&rsquo;t believe me then what do
      you think all those managed service companies are doing?
      Alright, so you need to learn to code, but most of the books
      suck for really learning if you know nothing. <!--l. 37-->

      <p class="noindent">This is why I started my own book
      <a href="http://learnpythonthehardway.org">Learn Python The
      Hard Way</a> for people who know nothing about programming
      but need or want to learn. It teaches Python but it mostly
      teaches all the things programmers actually learn before they
      learn programming. When you&rsquo;re done with my book
      you&rsquo;ll have your &rdquo;programming brown belt&rdquo;.
      That means you can then move onto one of many other free
      online books and really learn programming, and have a higher
      chance of actually learning it. <!--l. 45-->

      <p class="noindent">If you can&rsquo;t code Python then you
      can probably muddle through this and you may learn something,
      but learning Python will be important later. <!--l. 48-->

      <p class="noindent">But <span class=
      "pplri7t-">don&rsquo;t</span> read &rdquo;Dive Into
      Python&rdquo; as it is a horrible introduction.
    </div>
  </div>
  <hr class="endfloat">

  <h4 class="subsectionHead"><span class="titlemark">4.1.1</span>
  <a id="x1-380004.1.1" name="x1-380004.1.1"></a>Introducing
  procer</h4><!--l. 53-->

  <p class="noindent">When I started working on this little manual
  I wanted to get you into setting up a well managed and automated
  deployment system. The <span class="pplri7t-">m2sh</span> program
  does much of the automation you need, but Mongrel2 also has to
  talk to quite a few separate little pieces that run as separate
  processes. Trying to juggle all these processes without a tool to
  help is a nightmare. You end up writing init scripts and merging
  them into your boot process and all sorts of crazy antics just so
  you can run a stupid hello world demo. <!--l. 61-->

  <p class="indent">What I needed was a &rdquo;user space process
  manager&rdquo;. These are programs that run other programs, but
  more importantly try to keep those other programs running without
  much human intervention. When you need to deploy a ton of
  processes that all have to be running, these USPMs are fantastic.
  They usually read some startup profile describing what needs to
  start and what they depend on, and then it kicks everything into
  gear and watches them. If any of the processes crash they try to
  restart them. Very simple. <!--l. 68-->

  <p class="indent">There&rsquo;s just one catch, all of them suck.
  There&rsquo;s <a href=
  "http://cr.yp.to/daemontools.html">daemontools</a> which barely
  builds (if at all) and then assumes that daemons don&rsquo;t
  fork. Stupid. There&rsquo;s <a href=
  "http://www.fefe.de/minit/">minit</a> which bafflingly required
  dietlibc to even compile and assumed it was going to be the one
  true init (not user space at all). There&rsquo;s <a href=
  "http://www.nico.schottelius.org/software/cinit/">cinit</a> which
  got through a compile then barfed on its documentation, and the
  end result is some huge number of weird shell scripts to make it
  work, and again it wants to be the one true init. Finally
  <a href="http://smarden.org/runit/">runit</a> is some of the
  worst C code I&rsquo;ve seen in years and has the same weird
  design as daemontools. <!--l. 78-->

  <p class="indent">After trying every single one I just gave up.
  Either they didn&rsquo;t build, were too complex, expected to be
  the one true init, poorly documented, not maintained, and
  definitely not going to work for this manual. My only choice was
  to shave a yak and write my own. <!--l. 82-->

  <p class="indent">The end result is <span class=
  "pplri7t-">procer</span> which lives in <span class=
  "pplb7t-">examples/procer</span> and does most of what you need
  in a USPM. It works a lot like daemontools or minit but is much
  simpler with these differences: <!--l. 86-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-38002x1">It is much simpler, with
    only a single command to start all your stuff and keep it
    running.

    <li class="enumerate" id="x1-38004x2">It will build anywhere
    Mongrel2 will build because it reuses the <span class=
    "pplb7t-">libm2.a</span> library from the Mongrel2 project.

    <li class="enumerate" id="x1-38006x3">It doesn&rsquo;t want to
    be the one true init, or expect to be running constantly even.
    You can start it and stop it and it will only run what&rsquo;s
    not already running.

    <li class="enumerate" id="x1-38008x4">It assumes that programs
    will always daemonize and create a PID file. This turns out to
    be way easier to manage than what daemontools does, so
    I&rsquo;m sort of baffled why daemontools is how it is.

    <li class="enumerate" id="x1-38010x5">It has dependency
    management so that you can have processes start only after
    others have finished.

    <li class="enumerate" id="x1-38012x6">It still uses simple
    files to configure itself that are in separate directories.

    <li class="enumerate" id="x1-38014x7">It can be run as root,
    and like Mongrel2 it will drop privileges to the owner of the
    profile directory before it runs the command. This is
    incredibly useful because it lets you setup scripts that run as
    other users without much configuration or fuss.

    <li class="enumerate" id="x1-38016x8">It is dinky tiny and well
    written so you can understand it, even though it&rsquo;s
    written in C.

    <li class="enumerate" id="x1-38018x9">Best of all, I can use it
    in this book and you won&rsquo;t go insane trying to install it
    or use it like the others.
  </ol><!--l. 108-->

  <p class="indent">Of course, if you have something else you like
  then please use it. Anything that automates process management
  will be your friend. In this manual, to keep things simple and
  easily understood I&rsquo;ll be using <span class=
  "pplri7t-">procer</span> to tell you how to setup everything. 
  <!--l. 112-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">4.1.2</span>
  <a id="x1-390004.1.2" name="x1-390004.1.2"></a>Installing
  procer</h4><!--l. 114-->

  <p class="noindent">Installing procer is very easy. It&rsquo;s a
  single little binary and it lives in <span class=
  "pplb7t-">examples/procer</span> in the Mongrel2 source.
  Here&rsquo;s how you&rsquo;d install it totally from scratch as
  if you hadn&rsquo;t even build Mongrel2 yet: <!--l. 118-->

  <p class="indent"><a id="x1-39001r11" name="x1-39001r11"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 11:</span> <span class=
      "content"><span class="pplri7t-">Install</span> <span class=
      "pplri7t-">procer</span></span>
    </div><!--tex4ht:label?: x1-39001r11 -->

    <div class="fancyvrb" id="fancyvrb11">
      <a id="x1-39003r1" name="x1-39003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;projects/mongrel2</span><br class=
      "fancyvrb">
      <a id="x1-39005r2" name="x1-39005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;clean</span><span class=
      "pcrr7t-x-x-90">&nbsp;all</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span><br class="fancyvrb">
      <a id="x1-39007r3" name="x1-39007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;examples/procer</span><br class=
      "fancyvrb">
      <a id="x1-39009r4" name="x1-39009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;clean</span><span class=
      "pcrr7t-x-x-90">&nbsp;all</span><span class=
      "pcrr7t-x-x-90">&nbsp;install</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 127-->

  <p class="indent">That&rsquo;s the entire install process, and
  now procer is in <span class="pplb7t-">/usr/local/bin</span> so
  you can use it. In the rest of this chapter you&rsquo;ll learn
  how to use <span class="pplri7t-">procer</span> by just setting
  up the Mongrel2 demo completely and messing around with it.

  <h3 class="sectionHead"><span class="titlemark">4.2</span> <a id=
  "x1-400004.2" name="x1-400004.2"></a>The Plan</h3><!--l. 134-->

  <p class="noindent">We need to plan this deployment to make sure
  we get the end result correct: <!--l. 136-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-40002x1">Create a deployment area
    where everything will live.

    <li class="enumerate" id="x1-40004x2">Create a config.sqlite
    that will work with the demos in <span class=
    "pplri7t-">examples</span>.

    <li class="enumerate" id="x1-40006x3">Setup procer to run
    mongrel2 and the three demo Python scripts for chat,
    handlertest, and mp3stream, and have it run the fake backend
    web.py project so we have something to proxy to.

    <li class="enumerate" id="x1-40008x4">Get all the static file
    content working.

    <li class="enumerate" id="x1-40010x5">Test out that procer is
    keeping things running and play with taking things down and up
    and using <span class="pplri7t-">m2sh</span> to work with the
    deployment.
  </ol><!--l. 146-->

  <p class="indent">Once you have this setup working you can then
  start to make your own deployments and tweak things as you need
  for your own applications. Remember that the goal is to get you
  to <span class="pplri7t-">automate</span> everything as much as
  possible, so you can go further than this then do it. 
  <!--l. 151-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">4.3</span> <a id=
  "x1-410004.3" name="x1-410004.3"></a>Step 1: The Deployment
  Area</h3><!--l. 153-->

  <p class="noindent">We&rsquo;ll need a place to put all this
  stuff and run it so that Mongrel2 can chroot there, procer knows
  where its profiles are, and its all nice and clean. For these
  instructions we&rsquo;re just going to make some directories in
  your home directory, but feel free to change this up later if you
  find a better way. <!--l. 158-->

  <p class="indent"><a id="x1-41001r12" name="x1-41001r12"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 12:</span> <span class=
      "content"><span class="pplri7t-">Make Deployment</span>
      <span class="pplri7t-">Directories</span></span>
    </div><!--tex4ht:label?: x1-41001r12 -->

    <div class="fancyvrb" id="fancyvrb12">
      <a id="x1-41003r1" name="x1-41003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;go</span><span class=
      "pcrr7t-x-x-90">&nbsp;home</span><span class=
      "pcrr7t-x-x-90">&nbsp;first</span><br class="fancyvrb">
      <a id="x1-41005r2" name="x1-41005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/</span><br class="fancyvrb">
      <a id="x1-41007r3" name="x1-41007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41009r4" name="x1-41009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;create</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;dir</span><br class="fancyvrb">
      <a id="x1-41011r5" name="x1-41011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><br class="fancyvrb">
      <a id="x1-41013r6" name="x1-41013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment/</span><br class="fancyvrb">
      <a id="x1-41015r7" name="x1-41015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41017r8" name="x1-41017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;fill</span><span class=
      "pcrr7t-x-x-90">&nbsp;it</span><span class=
      "pcrr7t-x-x-90">&nbsp;with</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;directories</span><span class=
      "pcrr7t-x-x-90">&nbsp;we</span><span class=
      "pcrr7t-x-x-90">&nbsp;need</span><br class="fancyvrb">
      <a id="x1-41019r9" name="x1-41019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><br class="fancyvrb">
      <a id="x1-41021r10" name="x1-41021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;tmp</span><br class="fancyvrb">
      <a id="x1-41023r11" name="x1-41023r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs</span><br class="fancyvrb">
      <a id="x1-41025r12" name="x1-41025r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;static</span><br class="fancyvrb">
      <a id="x1-41027r13" name="x1-41027r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles</span><br class="fancyvrb">
      <a id="x1-41029r14" name="x1-41029r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41031r15" name="x1-41031r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;create</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;profile</span><span class=
      "pcrr7t-x-x-90">&nbsp;dirs</span><span class=
      "pcrr7t-x-x-90">&nbsp;for</span><span class=
      "pcrr7t-x-x-90">&nbsp;each</span><span class=
      "pcrr7t-x-x-90">&nbsp;thing</span><br class="fancyvrb">
      <a id="x1-41033r16" name="x1-41033r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/</span><br class="fancyvrb">
      <a id="x1-41035r17" name="x1-41035r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment/profiles</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mkdir</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><span class=
      "pcrr7t-x-x-90">&nbsp;mp3stream</span><span class=
      "pcrr7t-x-x-90">&nbsp;handlertest</span><span class=
      "pcrr7t-x-x-90">&nbsp;web</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-41037r18" name="x1-41037r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41039r19" name="x1-41039r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment/profiles</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;..</span><br class="fancyvrb">
      <a id="x1-41041r20" name="x1-41041r20"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41043r21" name="x1-41043r21"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;setup</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;database</span><span class=
      "pcrr7t-x-x-90">&nbsp;initially</span><br class="fancyvrb">
      <a id="x1-41045r22" name="x1-41045r22"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;init</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><br class=
      "fancyvrb">
      <a id="x1-41047r23" name="x1-41047r23"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41049r24" name="x1-41049r24"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;copy</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2_conf.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;sample</span><span class=
      "pcrr7t-x-x-90">&nbsp;from</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;source</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;here</span><br class="fancyvrb">
      <a id="x1-41051r25" name="x1-41051r25"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cp</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/projects/mongrel2/examples/python/tests/mongrel2_org.py</span><span class="pcrr7t-x-x-90">&nbsp;config.py</span><br class="fancyvrb">
      <a id="x1-41053r26" name="x1-41053r26"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-41055r27" name="x1-41055r27"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;see</span><span class=
      "pcrr7t-x-x-90">&nbsp;our</span><span class=
      "pcrr7t-x-x-90">&nbsp;end</span><span class=
      "pcrr7t-x-x-90">&nbsp;results</span><br class="fancyvrb">
      <a id="x1-41057r28" name="x1-41057r28"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ls</span><br class="fancyvrb">
      <a id="x1-41059r29" name="x1-41059r29"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;logs profiles</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;tmp</span><br class="fancyvrb">
      <a id="x1-41061r30" name="x1-41061r30"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 193-->

  <p class="indent">Hopefully you&rsquo;re starting to see how you
  could easily automate this so that you don&rsquo;t have to do
  this all the time. I&rsquo;m just showing you how to &rdquo;make
  the sausage&rdquo; so that you know where everything goes. Future
  versions of <span class="pplri7t-">m2sh</span> will most likely
  create deployment directories like this automatically. 
  <!--l. 198-->

  <p class="indent">What we&rsquo;ve done here is the following:

  <ol class="enumerate1">
    <li class="enumerate" id="x1-41063x1">Setup a &nbsp;/deployment
    directory we&rsquo;ll put everything inside.

    <li class="enumerate" id="x1-41065x2">Created run, tmp, logs,
    and profiles that Mongrel2 and procer need to run.

    <li class="enumerate" id="x1-41067x3">In profiles we started
    dirs for chat, mp3stream, handlertest, web, and mongrel2 that
    procer will read files out of to get all our gear up and
    running.

    <li class="enumerate" id="x1-41069x4">Initialized the
    config.sqlite file we&rsquo;ll be filling in with our modififed
    config.py.

    <li class="enumerate" id="x1-41071x5">Copied the
    mongrel2_org.py example file over to our deployment so we can
    modify it.
  </ol>

  <h3 class="sectionHead"><span class="titlemark">4.4</span> <a id=
  "x1-420004.4" name="x1-420004.4"></a>Step 2: The mongrel2.org
  Configuration</h3><!--l. 212-->

  <p class="noindent">Now we&rsquo;re ready to get the
  configuration working. Here&rsquo;s the thing though, you should
  try to alter the configuration yourself. I&rsquo;ve already given
  you the file and you are going to have to make the changes to
  meet the requirements for this deployment directory. Here&rsquo;s
  what you have to change in <span class="pplb7t-">config.py</span>
  to make everything work right: <!--l. 217-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-42002x1">Get rid of the
    <span class="pplri7t-">test</span><span class=
    "pplri7t-">_directory</span> handler since we won&rsquo;t need
    it and any routes that mention it.

    <li class="enumerate" id="x1-42004x2">Change the <span class=
    "pplri7t-">base</span> of <span class=
    "pplri7t-">chat</span><span class=
    "pplri7t-">_demo</span><span class="pplri7t-">_dir</span> to
    <span class="pplb7t-">&rsquo;static/chatdemo&rsquo;</span>
    which we&rsquo;ll setup at the end.

    <li class="enumerate" id="x1-42006x3">Modify the server
    <span class="pplri7t-">chroot</span> so that it&rsquo;s
    <span class="pplb7t-">/home/YOU/deployment/</span>.

    <li class="enumerate" id="x1-42008x4">Use the <span class=
    "pplri7t-">m2sh uuid</span> command to make some new UUIDs for
    all the existing ones. This is optional but probably good idea
    to get in the habit now.

    <li class="enumerate" id="x1-42010x5">Change the <span class=
    "pplri7t-">port</span> for <span class=
    "pplri7t-">web</span><span class=
    "pplri7t-">_app</span><span class="pplri7t-">_proxy</span> so
    it points to 8080 instead of 80.

    <li class="enumerate" id="x1-42012x6">Finally, change any
    mention of &rdquo;mongrel2.org&rdquo; into
    &rdquo;localhost&rdquo; so that you can run it locally.
  </ol><!--l. 230-->

  <p class="indent">Once you have that all edited, you should be
  able to run <span class="pplri7t-">m2sh load -db
  config.sqlite</span> <span class="pplri7t-">-config
  config.py</span> and it&rsquo;ll just load it up. Try using
  <span class="pplri7t-">m2sh servers</span> and <span class=
  "pplri7t-">m2sh hosts</span> to take a peek. <!--l. 235-->

  <p class="indent">To test it out at this stage you can just run
  the config.sqlite that you did with these commands: <!--l. 238-->

  <p class="indent"><a id="x1-42013r13" name="x1-42013r13"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 13:</span> <span class=
      "content"><span class="pplri7t-">Testing The Initial</span>
      <span class="pplri7t-">Configuration</span></span>
    </div><!--tex4ht:label?: x1-42013r13 -->

    <div class="fancyvrb" id="fancyvrb13">
      <a id="x1-42015r1" name="x1-42015r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-42017r2" name="x1-42017r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;^C</span><br class="fancyvrb">
      <a id="x1-42019r3" name="x1-42019r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><span class=
      "pcrr7t-x-x-90">&nbsp;-sudo</span><br class="fancyvrb">
      <a id="x1-42021r4" name="x1-42021r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;less</span><span class=
      "pcrr7t-x-x-90">&nbsp;run/mongrel2.logs</span><br class=
      "fancyvrb">
      <a id="x1-42023r5" name="x1-42023r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;stop</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><span class=
      "pcrr7t-x-x-90">&nbsp;-murder</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 248-->

  <p class="indent">That&rsquo;s enough to make sure it runs, but
  you&rsquo;ve got nothing running so it mostly won&rsquo;t work at
  all. Just start up and then kill it right after.

  <h3 class="sectionHead"><span class="titlemark">4.5</span> <a id=
  "x1-430004.5" name="x1-430004.5"></a>Step 3: Setup procer</h3>
  <!--l. 255-->

  <p class="noindent">Now we want to make <span class=
  "pplri7t-">procer</span> start everything for us and keep it
  running. How <span class="pplri7t-">procer</span> works is you
  put a few special files into a directory in <span class=
  "pplb7t-">profiles</span>. This directory (say <span class=
  "pplb7t-">chat</span>) is the profile for that app, and when you
  start <span class="pplri7t-">procer</span> you point it at the
  main <span class="pplb7t-">profiles</span> directory it tries to
  run it. It&rsquo;s dead simple, and very easy to automate so
  we&rsquo;ll do it by hand and then you can do some automation
  later. <!--l. 263-->

  <p class="indent">Let&rsquo;s first setup a basic config that
  gets our skeleton profiles and make sure procer can run
  everything. <!--l. 266-->

  <p class="indent"><a id="x1-43001r14" name="x1-43001r14"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 14:</span> <span class=
      "content"><span class="pplri7t-">Skeleton procer</span>
      <span class="pplri7t-">Setup</span></span>
    </div><!--tex4ht:label?: x1-43001r14 -->

    <div class="fancyvrb" id="fancyvrb14">
      <a id="x1-43003r1" name="x1-43003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment</span><span class=
      "pcrr7t-x-x-90">&nbsp;$</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/</span><br class="fancyvrb">
      <a id="x1-43005r2" name="x1-43005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;ls</span><br class="fancyvrb">
      <a id="x1-43007r3" name="x1-43007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;handlertest</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mp3stream web</span><br class=
      "fancyvrb">
      <a id="x1-43009r4" name="x1-43009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43011r5" name="x1-43011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;all</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;restart</span><span class=
      "pcrr7t-x-x-90">&nbsp;settings</span><br class="fancyvrb">
      <a id="x1-43013r6" name="x1-43013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;i</span><span class="pcrr7t-x-x-90">&nbsp;in</span><span class="pcrr7t-x-x-90">&nbsp;&#8902;;</span><span class="pcrr7t-x-x-90">&nbsp;do</span><span class="pcrr7t-x-x-90">&nbsp;touch</span><span class="pcrr7t-x-x-90">&nbsp;$i/restart;</span><span class="pcrr7t-x-x-90">&nbsp;done</span><br class="fancyvrb">
      <a id="x1-43015r7" name="x1-43015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43017r8" name="x1-43017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;all</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;empty</span><span class=
      "pcrr7t-x-x-90">&nbsp;dependencies</span><br class=
      "fancyvrb">
      <a id="x1-43019r9" name="x1-43019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;i</span><span class="pcrr7t-x-x-90">&nbsp;in</span><span class="pcrr7t-x-x-90">&nbsp;&#8902;;</span><span class="pcrr7t-x-x-90">&nbsp;do</span><span class="pcrr7t-x-x-90">&nbsp;touch</span><span class="pcrr7t-x-x-90">&nbsp;$i/depends;</span><span class="pcrr7t-x-x-90">&nbsp;done</span><br class="fancyvrb">
      <a id="x1-43021r10" name="x1-43021r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43023r11" name="x1-43023r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;setup</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;pid_files</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;some</span><span class=
      "pcrr7t-x-x-90">&nbsp;sort</span><span class=
      "pcrr7t-x-x-90">&nbsp;of</span><span class=
      "pcrr7t-x-x-90">&nbsp;default</span><br class="fancyvrb">
      <a id="x1-43025r12" name="x1-43025r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;i</span><span class="pcrr7t-x-x-90">&nbsp;in</span><span class="pcrr7t-x-x-90">&nbsp;&#8902;;</span><span class="pcrr7t-x-x-90">&nbsp;do</span><span class="pcrr7t-x-x-90">&nbsp;echo</span><span class="pcrr7t-x-x-90">&nbsp;$PWD/$i/$i.pid</span><span class="pcrr7t-x-x-90">&nbsp;&gt;</span><span class="pcrr7t-x-x-90">&nbsp;$i/pid_file;</span><span class="pcrr7t-x-x-90">&nbsp;done</span><br class="fancyvrb">
      <a id="x1-43027r13" name="x1-43027r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;cat</span><span class="pcrr7t-x-x-90">&nbsp;chat/pid_file</span><br class="fancyvrb">
      <a id="x1-43029r14" name="x1-43029r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43031r15" name="x1-43031r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;get</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><span class=
      "pcrr7t-x-x-90">&nbsp;script</span><span class=
      "pcrr7t-x-x-90">&nbsp;setup</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;do</span><span class=
      "pcrr7t-x-x-90">&nbsp;nothing</span><br class="fancyvrb">
      <a id="x1-43033r16" name="x1-43033r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;i</span><span class="pcrr7t-x-x-90">&nbsp;in</span><span class="pcrr7t-x-x-90">&nbsp;&#8902;;</span><span class="pcrr7t-x-x-90">&nbsp;do</span><span class="pcrr7t-x-x-90">&nbsp;echo</span><span class="pcrr7t-x-x-90">&nbsp;'#!/bin/sh'</span><span class="pcrr7t-x-x-90">&nbsp;&gt;</span><span class="pcrr7t-x-x-90">&nbsp;$i/run;</span><span class="pcrr7t-x-x-90">&nbsp;done</span><br class="fancyvrb">
      <a id="x1-43035r17" name="x1-43035r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;i</span><span class="pcrr7t-x-x-90">&nbsp;in</span><span class="pcrr7t-x-x-90">&nbsp;&#8902;;</span><span class="pcrr7t-x-x-90">&nbsp;do</span><span class="pcrr7t-x-x-90">&nbsp;chmod</span><span class="pcrr7t-x-x-90">&nbsp;u+x</span><span class="pcrr7t-x-x-90">&nbsp;$i/run;</span><span class="pcrr7t-x-x-90">&nbsp;done</span><br class="fancyvrb">
      <a id="x1-43037r18" name="x1-43037r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43039r19" name="x1-43039r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;check</span><span class=
      "pcrr7t-x-x-90">&nbsp;out</span><span class=
      "pcrr7t-x-x-90">&nbsp;what</span><span class=
      "pcrr7t-x-x-90">&nbsp;we</span><span class=
      "pcrr7t-x-x-90">&nbsp;did</span><br class="fancyvrb">
      <a id="x1-43041r20" name="x1-43041r20"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;$</span><span class="pcrr7t-x-x-90">&nbsp;ls</span><span class="pcrr7t-x-x-90">&nbsp;-lR</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 291-->

  <p class="indent">With all of that you can then try to run
  <span class="pplri7t-">procer</span> to watch it fail but still
  try to run everything:

  <div class="fancyvrb" id="fancyvrb15">
    <a id="x1-43043r1" name="x1-43043r1"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;&gt;</span><span class=
    "pcrr7t-">&nbsp;sudo</span><span class=
    "pcrr7t-">&nbsp;procer</span><span class=
    "pcrr7t-">&nbsp;$PWD</span><span class=
    "pcrr7t-">&nbsp;$PWD/../run/procer.pid</span><br class=
    "fancyvrb">
    <a id="x1-43045r2" name="x1-43045r2"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;&gt;</span><span class=
    "pcrr7t-">&nbsp;less</span><span class=
    "pcrr7t-">&nbsp;error.log</span>
  </div><!--l. 299-->

  <p class="indent">This is assuming that you are still in the
  <span class="pplb7t-">profiles</span> directory and what you
  should a file <span class="pplb7t-">error.log</span> get created
  and probably some messages printed to the screen. Just ignore any
  mention of Mongrel2 since that&rsquo;s probably just cruft from
  the <span class="pplb7t-">libm2.a</span> we haven&rsquo;t
  removed. <!--l. 305-->

  <p class="indent">Take a look in the <span class=
  "pplb7t-">error.log</span> and you&rsquo;ll see it&rsquo;s not
  necessarily errors but information on how things were run. What
  you should see is something like this for each profile: 
  <!--l. 309-->

  <p class="indent"><a id="x1-43046r15" name="x1-43046r15"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 15:</span> <span class=
      "content"><span class="pplri7t-">First Dummy Run Of</span>
      <span class="pplri7t-">procer</span></span>
    </div><!--tex4ht:label?: x1-43046r15 -->

    <div class="fancyvrb" id="fancyvrb16">
      <a id="x1-43048r1" name="x1-43048r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEBUG</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer.c:232:</span><span class=
      "pcrr7t-x-x-90">&nbsp;Loading</span><span class=
      "pcrr7t-x-x-90">&nbsp;5</span><span class=
      "pcrr7t-x-x-90">&nbsp;actions.</span><br class="fancyvrb">
      <a id="x1-43050r2" name="x1-43050r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEBUG</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer.c:83:</span><span class=
      "pcrr7t-x-x-90">&nbsp;STARTED</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><br class="fancyvrb">
      <a id="x1-43052r3" name="x1-43052r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ERROR</span><span class=
      "pcrr7t-x-x-90">&nbsp;Failed</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;open</span><span class=
      "pcrr7t-x-x-90">&nbsp;PID</span><span class=
      "pcrr7t-x-x-90">&nbsp;file</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/profiles/chat/chat.pid</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;reading.</span><br class="fancyvrb">
      <a id="x1-43054r4" name="x1-43054r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ERROR</span><span class=
      "pcrr7t-x-x-90">&nbsp;Failed</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;open</span><span class=
      "pcrr7t-x-x-90">&nbsp;PID</span><span class=
      "pcrr7t-x-x-90">&nbsp;file</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/profiles/chat/chat.pid</span><span class="pcrr7t-x-x-90">&nbsp;for</span><span class="pcrr7t-x-x-90">&nbsp;reading.</span><br class="fancyvrb">
      <a id="x1-43056r5" name="x1-43056r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;INFO</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;No</span><span class=
      "pcrr7t-x-x-90">&nbsp;previous</span><span class=
      "pcrr7t-x-x-90">&nbsp;Mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;running,</span><span class=
      "pcrr7t-x-x-90">&nbsp;continuing</span><span class=
      "pcrr7t-x-x-90">&nbsp;on.</span><br class="fancyvrb">
      <a id="x1-43058r6" name="x1-43058r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEBUG</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer.c:37:</span><span class=
      "pcrr7t-x-x-90">&nbsp;ACTION:</span><span class=
      "pcrr7t-x-x-90">&nbsp;command=/home/zedshaw/deployment/profiles/chat/run,</span><span class="pcrr7t-x-x-90">&nbsp;pid_file=/home/zedshaw/deployment/profiles/chat/chat.pid,</span><span class="pcrr7t-x-x-90">&nbsp;restart=1,</span><span class="pcrr7t-x-x-90">&nbsp;depends=(null)</span><br class="fancyvrb">
      <a id="x1-43060r7" name="x1-43060r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEBUG</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer.c:56:</span><span class=
      "pcrr7t-x-x-90">&nbsp;WAITING</span><span class=
      "pcrr7t-x-x-90">&nbsp;FOR</span><span class=
      "pcrr7t-x-x-90">&nbsp;CHILD.</span><br class="fancyvrb">
      <a id="x1-43062r8" name="x1-43062r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;INFO</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Now</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><span class=
      "pcrr7t-x-x-90">&nbsp;as</span><span class=
      "pcrr7t-x-x-90">&nbsp;UID:1000,</span><span class=
      "pcrr7t-x-x-90">&nbsp;GID:1000</span><br class="fancyvrb">
      <a id="x1-43064r9" name="x1-43064r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEBUG</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer.c:60:</span><span class=
      "pcrr7t-x-x-90">&nbsp;Command</span><span class=
      "pcrr7t-x-x-90">&nbsp;ran</span><span class=
      "pcrr7t-x-x-90">&nbsp;and</span><span class=
      "pcrr7t-x-x-90">&nbsp;exited</span><span class=
      "pcrr7t-x-x-90">&nbsp;successfully,</span><span class=
      "pcrr7t-x-x-90">&nbsp;now</span><span class=
      "pcrr7t-x-x-90">&nbsp;looking</span><span class=
      "pcrr7t-x-x-90">&nbsp;for</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;PID</span><span class=
      "pcrr7t-x-x-90">&nbsp;file.</span><br class="fancyvrb">
      <a id="x1-43066r10" name="x1-43066r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ERROR</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><span class=
      "pcrr7t-x-x-90">&nbsp;didn't</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;pidfile</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/profiles/chat/chat.pid.</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 324-->

  <p class="indent">I&rsquo;ve cleaned this up a bit, and again
  ignore that it&rsquo;s saying &rdquo;Mongrel2&rdquo;,
  that&rsquo;s just cruft from the library since it was originally
  designed for Mongrel2. What you can see here is the following:

  <ol class="enumerate1">
    <li class="enumerate" id="x1-43068x1">It starts up and says it
    found 5 profiles.

    <li class="enumerate" id="x1-43070x2">It starts chat, and says
    there&rsquo;s no PID file so good to continue.

    <li class="enumerate" id="x1-43072x3">It reports what ACTION
    it&rsquo;s running, so you can see the config.

    <li class="enumerate" id="x1-43074x4">It spawns off your
    <span class="pplb7t-">run</span> script, <span class=
    "pplri7t-">drops privilege</span> and says it&rsquo;s WAITING
    for your script to exit.

    <li class="enumerate" id="x1-43076x5">After your script runs it
    looks for the PID file you gave in <span class=
    "pplb7t-">pid</span><span class="pplb7t-">_file</span> and if
    its not there then it exits that action.

    <li class="enumerate" id="x1-43078x6">It does this for all of
    them and since none of them run right <span class=
    "pplri7t-">procer</span> exits.
  </ol><!--l. 338-->

  <p class="indent">Next up lets get Mongrel2 running inside
  <span class="pplri7t-">procer</span>: <!--l. 340-->

  <p class="indent"><a id="x1-43079r16" name="x1-43079r16"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 16:</span> <span class=
      "content"><span class="pplri7t-">procer Config For</span>
      <span class="pplri7t-">Mongrel2</span></span>
    </div><!--tex4ht:label?: x1-43079r16 -->

    <div class="fancyvrb" id="fancyvrb17">
      <a id="x1-43081r1" name="x1-43081r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment</span><br class=
      "fancyvrb">
      <a id="x1-43083r2" name="x1-43083r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><span class=
      "pcrr7t-x-x-90">&nbsp;as</span><span class=
      "pcrr7t-x-x-90">&nbsp;root</span><br class="fancyvrb">
      <a id="x1-43085r3" name="x1-43085r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;chown</span><span class=
      "pcrr7t-x-x-90">&nbsp;root.root</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/mongrel2</span><br class=
      "fancyvrb">
      <a id="x1-43087r4" name="x1-43087r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43089r5" name="x1-43089r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;tell</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;where</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;puts</span><span class=
      "pcrr7t-x-x-90">&nbsp;its</span><span class=
      "pcrr7t-x-x-90">&nbsp;pid_file</span><br class="fancyvrb">
      <a id="x1-43091r6" name="x1-43091r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;notice</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;not</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;on</span><span class=
      "pcrr7t-x-x-90">&nbsp;this</span><br class="fancyvrb">
      <a id="x1-43093r7" name="x1-43093r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;"$PWD/run/mongrel2.pid"</span><span class="pcrr7t-x-x-90">&nbsp;&gt;</span><span class="pcrr7t-x-x-90">&nbsp;profiles/mongrel2/pid_file</span><br class="fancyvrb">
      <a id="x1-43095r8" name="x1-43095r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43097r9" name="x1-43097r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;make</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><span class=
      "pcrr7t-x-x-90">&nbsp;script</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;(notice</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;on</span><span class=
      "pcrr7t-x-x-90">&nbsp;this)</span><br class="fancyvrb">
      <a id="x1-43099r10" name="x1-43099r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;"cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;$PWD"</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/mongrel2/run</span><br class=
      "fancyvrb">
      <a id="x1-43101r11" name="x1-43101r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;"m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost"</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/mongrel2/run</span><br class=
      "fancyvrb">
      <a id="x1-43103r12" name="x1-43103r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43105r13" name="x1-43105r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;check</span><span class=
      "pcrr7t-x-x-90">&nbsp;out</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;results</span><br class="fancyvrb">
      <a id="x1-43107r14" name="x1-43107r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cat</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/mongrel2/run</span><br class=
      "fancyvrb">
      <a id="x1-43109r15" name="x1-43109r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#!/bin/sh</span><br class="fancyvrb">
      <a id="x1-43111r16" name="x1-43111r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment</span><br class="fancyvrb">
      <a id="x1-43113r17" name="x1-43113r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 362-->

  <p class="indent">Obviously you don&rsquo;t have to use a series
  of <span class="pplri7t-">echo</span> commands to make these
  scripts. You can edit them just fine, we&rsquo;re just doing it
  this way so that you can follow along easier. <!--l. 366-->

  <p class="indent">Now, make sure you don&rsquo;t have any other
  Mongrel2 processes running and then start procer again to see if
  it starts this configuration correctly. <!--l. 371-->

  <p class="indent"><a id="x1-43114r17" name="x1-43114r17"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 17:</span> <span class=
      "content"><span class="pplri7t-">Using procer To Run</span>
      <span class="pplri7t-">Mongrel2</span></span>
    </div><!--tex4ht:label?: x1-43114r17 -->

    <div class="fancyvrb" id="fancyvrb18">
      <a id="x1-43116r1" name="x1-43116r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;~/deployment</span><br class=
      "fancyvrb">
      <a id="x1-43118r2" name="x1-43118r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;clear</span><span class=
      "pcrr7t-x-x-90">&nbsp;out</span><span class=
      "pcrr7t-x-x-90">&nbsp;the</span><span class=
      "pcrr7t-x-x-90">&nbsp;error.log</span><span class=
      "pcrr7t-x-x-90">&nbsp;for</span><span class=
      "pcrr7t-x-x-90">&nbsp;testing</span><br class="fancyvrb">
      <a id="x1-43120r3" name="x1-43120r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;rm</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/error.log</span><br class=
      "fancyvrb">
      <a id="x1-43122r4" name="x1-43122r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43124r5" name="x1-43124r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;start</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><br class="fancyvrb">
      <a id="x1-43126r6" name="x1-43126r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;$PWD/profiles</span><span class=
      "pcrr7t-x-x-90">&nbsp;$PWD/procer.pid</span><br class=
      "fancyvrb">
      <a id="x1-43128r7" name="x1-43128r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43130r8" name="x1-43130r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;see</span><span class=
      "pcrr7t-x-x-90">&nbsp;if</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;is</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><br class="fancyvrb">
      <a id="x1-43132r9" name="x1-43132r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><br class="fancyvrb">
      <a id="x1-43134r10" name="x1-43134r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;17934</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Ss</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/procer.pid</span><br class="fancyvrb">
      <a id="x1-43136r11" name="x1-43136r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-43138r12" name="x1-43138r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;see</span><span class=
      "pcrr7t-x-x-90">&nbsp;if</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;is</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><br class="fancyvrb">
      <a id="x1-43140r13" name="x1-43140r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-43142r14" name="x1-43142r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;17944</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Ssl</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-43144r15" name="x1-43144r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 391-->

  <p class="indent">To watch <span class="pplri7t-">procer</span>
  in action, try doing <span class="pplri7t-">m2sh stop -db
  config.sqlite -host localhost</span> <span class=
  "pplri7t-">-murder</span> and then look at <span class=
  "pplb7t-">profiles/error.log</span> and watch Mongrel2 come right
  back.

  <h4 class="subsectionHead"><span class="titlemark">4.5.1</span>
  <a id="x1-440004.5.1" name="x1-440004.5.1"></a>The Python
  Examples</h4><!--l. 398-->

  <p class="noindent">We&rsquo;ve got a good setup of <span class=
  "pplri7t-">procer</span> going and it keeps Mongrel2 running so
  let&rsquo;s setup a similar thing for each of our little Python
  demos that we&rsquo;ll need. In order to do this though we sort
  of have to &rdquo;hack&rdquo; in making them daemonize and create
  PID files with a little shell script help. Let&rsquo;s start with
  the <span class="pplri7t-">chat</span> demo and assuming your
  mongrel2 source is in <span class=
  "pplb7t-">&nbsp;/projects/mongrel2</span> you will change
  <span class="pplb7t-">profiles/chat/run</span> to be like this: 
  <!--l. 406-->

  <p class="indent"><a id="x1-44001r18" name="x1-44001r18"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 18:</span> <span class=
      "content"><span class="pplri7t-">Run Script For Chat</span>
      <span class="pplri7t-">Demo</span></span>
    </div><!--tex4ht:label?: x1-44001r18 -->

    <div class="fancyvrb" id="fancyvrb19">
      <a id="x1-44003r1" name="x1-44003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#!/bin/sh</span><br class="fancyvrb">
      <a id="x1-44005r2" name="x1-44005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;set</span><span class=
      "pcrr7t-x-x-90">&nbsp;-e</span><br class="fancyvrb">
      <a id="x1-44007r3" name="x1-44007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44009r4" name="x1-44009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEPLOY=/home/YOU/deployment</span><br class="fancyvrb">
      <a id="x1-44011r5" name="x1-44011r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;SOURCE=/home/YOU/projects/mongrel2</span><br class="fancyvrb">
      <a id="x1-44013r6" name="x1-44013r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44015r7" name="x1-44015r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;$SOURCE/examples/chat</span><br class=
      "fancyvrb">
      <a id="x1-44017r8" name="x1-44017r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;nohup</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;2&gt;&amp;1</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat.log</span><span class=
      "pcrr7t-x-x-90">&nbsp;&amp;</span><br class="fancyvrb">
      <a id="x1-44019r9" name="x1-44019r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;$!</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;$DEPLOY/profiles/chat/chat.pid</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 420-->

  <p class="indent">This little script uses some funky features you
  might not be familiar with but which are nice to learn, so
  let&rsquo;s take a look:

  <ol class="enumerate1">
    <li class="enumerate" id="x1-44021x1">The first trick is
    <span class="pplri7t-">set -e</span> which tell bash to bail if
    there&rsquo;s any errors in your script. This is a <span class=
    "pplri7t-">huge</span> life saver in system scripts.

    <li class="enumerate" id="x1-44023x2">Next you point some
    variables at where the deployment and Mongrel2 source live,
    remembering to not type YOU but your username.

    <li class="enumerate" id="x1-44025x3">After that you run the
    <span class="pplb7t-">chat.py</span> but you use a program
    called <span class="pplri7t-">nohup</span>. This basically
    daemonizes your script by redirecting output and preventing the
    program from exiting, and then you background it with
    <span class="obeylines-h verb pcrr7t-">&amp;</span>.

    <li class="enumerate" id="x1-44027x4">The final thing we do is
    echo the magic variable <span class=
    "obeylines-h verb pcrr7t-">$!</span> to the <span class=
    "pplb7t-">chat.pid</span> file in the profile directory.
  </ol><!--l. 438-->

  <p class="indent">When you run this manually you should see
  something like this:

  <div class="fancyvrb" id="fancyvrb20">
    <a id="x1-44029r1" name="x1-44029r1"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;&gt;</span><span class=
    "pcrr7t-">&nbsp;./profiles/chat/run</span><br class="fancyvrb">
    <a id="x1-44031r2" name="x1-44031r2"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;nohup:</span><span class=
    "pcrr7t-">&nbsp;redirecting</span><span class=
    "pcrr7t-">&nbsp;stderr</span><span class=
    "pcrr7t-">&nbsp;to</span><span class=
    "pcrr7t-">&nbsp;stdout</span><br class="fancyvrb">
    <a id="x1-44033r3" name="x1-44033r3"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><br class="fancyvrb">
    <a id="x1-44035r4" name="x1-44035r4"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;&gt;</span><span class=
    "pcrr7t-">&nbsp;ps</span><span class=
    "pcrr7t-">&nbsp;ax</span><span class=
    "pcrr7t-">&nbsp;|</span><span class=
    "pcrr7t-">&nbsp;grep</span><span class=
    "pcrr7t-">&nbsp;chat</span><br class="fancyvrb">
    <a id="x1-44037r5" name="x1-44037r5"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;19305</span><span class=
    "pcrr7t-">&nbsp;pts/1</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;Sl</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;0:00</span><span class=
    "pcrr7t-">&nbsp;python</span><span class=
    "pcrr7t-">&nbsp;chat.py</span><br class="fancyvrb">
    <a id="x1-44039r6" name="x1-44039r6"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;</span><br class="fancyvrb">
    <a id="x1-44041r7" name="x1-44041r7"></a><span class=
    "pcrr7t-">&nbsp;</span><span class=
    "pcrr7t-">&nbsp;&gt;</span><span class=
    "pcrr7t-">&nbsp;kill</span><span class=
    "pcrr7t-">&nbsp;-TERM</span><span class=
    "pcrr7t-">&nbsp;19305</span>
  </div><!--l. 450-->

  <p class="indent">After all that you can then try out
  <span class="pplri7t-">procer</span> again to see if it properly
  runs the chat demo as well as mongrel2: <!--l. 453-->

  <p class="indent"><a id="x1-44042r19" name="x1-44042r19"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 19:</span> <span class=
      "content"><span class="pplri7t-">Running procer With
      Chat</span> <span class="pplri7t-">Demo</span></span>
    </div><!--tex4ht:label?: x1-44042r19 -->

    <div class="fancyvrb" id="fancyvrb21">
      <a id="x1-44044r1" name="x1-44044r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;run</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;get</span><span class=
      "pcrr7t-x-x-90">&nbsp;stuff</span><span class=
      "pcrr7t-x-x-90">&nbsp;started</span><br class="fancyvrb">
      <a id="x1-44046r2" name="x1-44046r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;sudo</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;$PWD/profiles</span><span class=
      "pcrr7t-x-x-90">&nbsp;$PWD/run/procer.pid</span><br class=
      "fancyvrb">
      <a id="x1-44048r3" name="x1-44048r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44050r4" name="x1-44050r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;see</span><span class=
      "pcrr7t-x-x-90">&nbsp;if</span><span class=
      "pcrr7t-x-x-90">&nbsp;it's</span><span class=
      "pcrr7t-x-x-90">&nbsp;all</span><span class=
      "pcrr7t-x-x-90">&nbsp;running</span><br class="fancyvrb">
      <a id="x1-44052r5" name="x1-44052r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><br class="fancyvrb">
      <a id="x1-44054r6" name="x1-44054r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;19607</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Ss</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;procer</span><span class=
      "pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/profiles</span><span class="pcrr7t-x-x-90">&nbsp;/home/zedshaw/deployment/run/procer.pid</span><br class="fancyvrb">
      <a id="x1-44056r7" name="x1-44056r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44058r8" name="x1-44058r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><br class="fancyvrb">
      <a id="x1-44060r9" name="x1-44060r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;19621</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Ssl</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><br class="fancyvrb">
      <a id="x1-44062r10" name="x1-44062r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44064r11" name="x1-44064r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><br class="fancyvrb">
      <a id="x1-44066r12" name="x1-44066r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;19609</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Sl</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat.py</span><br class="fancyvrb">
      <a id="x1-44068r13" name="x1-44068r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44070r14" name="x1-44070r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#</span><span class=
      "pcrr7t-x-x-90">&nbsp;try</span><span class=
      "pcrr7t-x-x-90">&nbsp;killing</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><span class=
      "pcrr7t-x-x-90">&nbsp;to</span><span class=
      "pcrr7t-x-x-90">&nbsp;see</span><span class=
      "pcrr7t-x-x-90">&nbsp;if</span><span class=
      "pcrr7t-x-x-90">&nbsp;it</span><span class=
      "pcrr7t-x-x-90">&nbsp;comes</span><span class=
      "pcrr7t-x-x-90">&nbsp;back</span><br class="fancyvrb">
      <a id="x1-44072r15" name="x1-44072r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;kill</span><span class=
      "pcrr7t-x-x-90">&nbsp;-TERM</span><span class=
      "pcrr7t-x-x-90">&nbsp;&lsquo;cat</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/chat/chat.pid&lsquo;</span><br class="fancyvrb">
      <a id="x1-44074r16" name="x1-44074r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44076r17" name="x1-44076r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;ps</span><span class=
      "pcrr7t-x-x-90">&nbsp;ax</span><span class=
      "pcrr7t-x-x-90">&nbsp;|</span><span class=
      "pcrr7t-x-x-90">&nbsp;grep</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat</span><br class="fancyvrb">
      <a id="x1-44078r18" name="x1-44078r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;19669</span><span class=
      "pcrr7t-x-x-90">&nbsp;?</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Sl</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;0:00</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;chat.py</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 476-->

  <p class="indent">If you go look at <span class=
  "pplb7t-">profiles/error.log</span> you&rsquo;ll see that
  <span class="pplri7t-">procer</span> is also running each of them
  as the right user with chat being run as you, but Mongrel2 being
  run as root so it can chroot/drop priv properly. <!--l. 480-->

  <p class="indent">Rather than give you a walk through each of
  these setups, here&rsquo;s the run scripts for the remaining
  files: <!--l. 483-->

  <p class="indent"><a id="x1-44079r20" name="x1-44079r20"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 20:</span> <span class=
      "content"><span class="pplri7t-">Remaining Run</span>
      <span class="pplri7t-">Scripts</span></span>
    </div><!--tex4ht:label?: x1-44079r20 -->

    <div class="fancyvrb" id="fancyvrb22">
      <a id="x1-44081r1" name="x1-44081r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;---</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/handlertest/run</span><br class="fancyvrb">
      <a id="x1-44083r2" name="x1-44083r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#!/bin/sh</span><br class="fancyvrb">
      <a id="x1-44085r3" name="x1-44085r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;set</span><span class=
      "pcrr7t-x-x-90">&nbsp;-e</span><br class="fancyvrb">
      <a id="x1-44087r4" name="x1-44087r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44089r5" name="x1-44089r5"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEPLOY=/home/zedshaw/deployment</span><br class="fancyvrb">
      <a id="x1-44091r6" name="x1-44091r6"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;SOURCE=/home/zedshaw/projects/mongrel2</span><br class="fancyvrb">
      <a id="x1-44093r7" name="x1-44093r7"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44095r8" name="x1-44095r8"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;$SOURCE/examples/http_0mq</span><br class="fancyvrb">
      <a id="x1-44097r9" name="x1-44097r9"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;nohup</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;http.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;2&gt;&amp;1</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;http.log</span><span class=
      "pcrr7t-x-x-90">&nbsp;&amp;</span><br class="fancyvrb">
      <a id="x1-44099r10" name="x1-44099r10"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;$!</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;$DEPLOY/profiles/handlertest/handlertest.pid</span><br class="fancyvrb">
      <a id="x1-44101r11" name="x1-44101r11"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44103r12" name="x1-44103r12"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44105r13" name="x1-44105r13"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;---</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/mp3stream/run</span><br class=
      "fancyvrb">
      <a id="x1-44107r14" name="x1-44107r14"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#!/bin/sh</span><br class="fancyvrb">
      <a id="x1-44109r15" name="x1-44109r15"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;set</span><span class=
      "pcrr7t-x-x-90">&nbsp;-e</span><br class="fancyvrb">
      <a id="x1-44111r16" name="x1-44111r16"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44113r17" name="x1-44113r17"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEPLOY=/home/zedshaw/deployment</span><br class="fancyvrb">
      <a id="x1-44115r18" name="x1-44115r18"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;SOURCE=/home/zedshaw/projects/mongrel2</span><br class="fancyvrb">
      <a id="x1-44117r19" name="x1-44117r19"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44119r20" name="x1-44119r20"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;$SOURCE/examples/mp3stream</span><br class="fancyvrb">
      <a id="x1-44121r21" name="x1-44121r21"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;nohup</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;handler.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;2&gt;&amp;1</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;mp3stream.log</span><span class=
      "pcrr7t-x-x-90">&nbsp;&amp;</span><br class="fancyvrb">
      <a id="x1-44123r22" name="x1-44123r22"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;$!</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;$DEPLOY/profiles/mp3stream/mp3stream.pid</span><br class="fancyvrb">
      <a id="x1-44125r23" name="x1-44125r23"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44127r24" name="x1-44127r24"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;---</span><span class=
      "pcrr7t-x-x-90">&nbsp;profiles/web/run</span><br class=
      "fancyvrb">
      <a id="x1-44129r25" name="x1-44129r25"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;#!/bin/sh</span><br class="fancyvrb">
      <a id="x1-44131r26" name="x1-44131r26"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;set</span><span class=
      "pcrr7t-x-x-90">&nbsp;-e</span><br class="fancyvrb">
      <a id="x1-44133r27" name="x1-44133r27"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44135r28" name="x1-44135r28"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;DEPLOY=/home/zedshaw/deployment</span><br class="fancyvrb">
      <a id="x1-44137r29" name="x1-44137r29"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;SOURCE=/home/zedshaw/projects/mongrel2</span><br class="fancyvrb">
      <a id="x1-44139r30" name="x1-44139r30"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span><br class="fancyvrb">
      <a id="x1-44141r31" name="x1-44141r31"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cd</span><span class=
      "pcrr7t-x-x-90">&nbsp;$SOURCE/examples/chat</span><br class=
      "fancyvrb">
      <a id="x1-44143r32" name="x1-44143r32"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;nohup</span><span class=
      "pcrr7t-x-x-90">&nbsp;python</span><span class=
      "pcrr7t-x-x-90">&nbsp;www.py</span><span class=
      "pcrr7t-x-x-90">&nbsp;2&gt;&amp;1</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;www.log</span><span class=
      "pcrr7t-x-x-90">&nbsp;&amp;</span><br class="fancyvrb">
      <a id="x1-44145r33" name="x1-44145r33"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;echo</span><span class=
      "pcrr7t-x-x-90">&nbsp;$!</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;$DEPLOY/profiles/web/web.pid</span><br class="fancyvrb">
      <a id="x1-44147r34" name="x1-44147r34"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;</span>
    </div>
  </div>
  <hr class="endfloat">

  <h4 class="subsectionHead"><span class="titlemark">4.5.2</span>
  <a id="x1-450004.5.2" name="x1-450004.5.2"></a>Testing The New
  Setup</h4><!--l. 525-->

  <p class="noindent">Once everything is running and <span class=
  "pplri7t-">procer</span> is maintaining it you just need to see
  if things work. Here&rsquo;s some curl commands to try: 
  <!--l. 528-->

  <p class="indent"><a id="x1-45001r21" name="x1-45001r21"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 21:</span> <span class=
      "content"><span class="pplri7t-">Testing With</span>
      <span class="pplri7t-">Curl</span></span>
    </div><!--tex4ht:label?: x1-45001r21 -->

    <div class="fancyvrb" id="fancyvrb23">
      <a id="x1-45003r1" name="x1-45003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;curl</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://localhost:6767/</span><br class=
      "fancyvrb">
      <a id="x1-45005r2" name="x1-45005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;Hello,</span><span class=
      "pcrr7t-x-x-90">&nbsp;World!</span><br class="fancyvrb">
      <a id="x1-45007r3" name="x1-45007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;curl</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://localhost:6767/handlertest</span><br class="fancyvrb">
      <a id="x1-45009r4" name="x1-45009r4"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;...</span>
    </div>
  </div>
  <hr class="endfloat">

  <h4 class="subsectionHead"><span class="titlemark">4.5.3</span>
  <a id="x1-460004.5.3" name="x1-460004.5.3"></a>Nice Features of
  Procer</h4><!--l. 540-->

  <p class="noindent">There&rsquo;s some nice subtle features you
  get from using <span class="pplri7t-">procer</span> to run your
  stuff:

  <dl class="description">
    <dt class="description"><span class="pplb7t-">faster
    development</span>

    <dd class="description">A great thing about <span class=
    "pplri7t-">procer</span> is once you get all of this setup it
    cuts down on a lot of your setup time and development time
    because it will <span class="pplri7t-">properly</span> restart
    things for you. This means you can simply make changes to code
    or configs, and then just kill the process and procer will kick
    it back over automatically.

    <dt class="description"><span class="pplb7t-">easy
    automation</span>

    <dd class="description">You should start to see how you could
    automate creating profiles for new processes since the setup is
    consistent.

    <dt class="description"><span class=
    "pplb7t-">profiles/run.log</span>

    <dd class="description">All your commands will have their
    output sent to this file so you can see how they might be
    blowing up in your scripts.

    <dt class="description"><span class="pplb7t-">restart state
    maintained</span>

    <dd class="description">Since procer is just tracking PID files
    and processes, if you shut it down, it won&rsquo;t kill the
    world. When you start it back up it just starts new stuff or
    stuff it needs then goes back to supervising. This means you
    can change the configs for procer then just kick it over and
    it&rsquo;ll do the right thing.
  </dl><!--l. 560-->

  <p class="indent">The key thing though is that you now have the
  whole application for the mongrel2.org demo up and running,
  including automated process management, configuration, and
  managing everything. <!--l. 564-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">4.6</span> <a id=
  "x1-470004.6" name="x1-470004.6"></a>Step 4: Static Content</h3>
  <!--l. 566-->

  <p class="noindent">The final thing we have to do is get the
  static content we need to try out the chat demo: <!--l. 569-->

  <p class="indent"><a id="x1-47001r22" name="x1-47001r22"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Source 22:</span> <span class=
      "content"><span class="pplri7t-">Setting Up Static</span>
      <span class="pplri7t-">Content</span></span>
    </div><!--tex4ht:label?: x1-47001r22 -->

    <div class="fancyvrb" id="fancyvrb24">
      <a id="x1-47003r1" name="x1-47003r1"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;cp</span><span class=
      "pcrr7t-x-x-90">&nbsp;-r</span><span class=
      "pcrr7t-x-x-90">&nbsp;mongrel2/examples/chat/static</span><span class="pcrr7t-x-x-90">&nbsp;static/chatdemo</span><br class="fancyvrb">
      <a id="x1-47005r2" name="x1-47005r2"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;m2sh</span><span class=
      "pcrr7t-x-x-90">&nbsp;stop</span><span class=
      "pcrr7t-x-x-90">&nbsp;-db</span><span class=
      "pcrr7t-x-x-90">&nbsp;config.sqlite</span><span class=
      "pcrr7t-x-x-90">&nbsp;-host</span><span class=
      "pcrr7t-x-x-90">&nbsp;localhost</span><span class=
      "pcrr7t-x-x-90">&nbsp;-murder</span><br class="fancyvrb">
      <a id="x1-47007r3" name="x1-47007r3"></a><span class=
      "pcrr7t-x-x-90">&nbsp;</span><span class=
      "pcrr7t-x-x-90">&nbsp;&gt;</span><span class=
      "pcrr7t-x-x-90">&nbsp;curl</span><span class=
      "pcrr7t-x-x-90">&nbsp;-I</span><span class=
      "pcrr7t-x-x-90">&nbsp;http://localhost:6767/chatdemo/</span>
    </div>
  </div>
  <hr class="endfloat">
  <!--l. 577-->

  <p class="indent">If you get a good response then you should be
  able to go to <a href="http://localhost:6767/chatdemo/" class=
  "url"><span class=
  "pcrr7t-">http://localhost:6767/chatdemo/</span></a> and the chat
  should work. Notice also that you just killed mongrel2 with
  <span class="pplri7t-">m2sh</span> and it came back because of
  <span class="pplri7t-">procer</span>. If you do your curl check
  to fast then you might miss it so just wait a bit.

  <h3 class="sectionHead"><span class="titlemark">4.7</span> <a id=
  "x1-480004.7" name="x1-480004.7"></a>Step 5: Testing And
  Troubleshooting</h3><!--l. 585-->

  <p class="noindent">You should have been testing the
  configuration as you went, but the main things to test are: 
  <!--l. 588-->

  <p class="indent">

  <ol class="enumerate1">
    <li class="enumerate" id="x1-48002x1">The /chatdemo/ works and
    you can send messages, try a few different browsers.

    <li class="enumerate" id="x1-48004x2">You can get a simple
    message from the /handlertest/ and that&rsquo;s about it.

    <li class="enumerate" id="x1-48006x3">See if you can get the
    mp3streamer to stream some mp3s. Put a few in its directory
    then kill it so <span class="pplri7t-">procer</span> bring it
    back. Then point <span class="pplri7t-">mplayer</span> at
    <a href="http://localhost:6767/mp3stream" class=
    "url"><span class=
    "pcrr7t-">http://localhost:6767/mp3stream</span></a> and it
    should work.

    <li class="enumerate" id="x1-48008x4">Check that you can make
    the proxy go to the web.py app you start in the chat
    demo&rsquo;s directory.

    <li class="enumerate" id="x1-48010x5">See if you can stop
    things and have <span class="pplri7t-">procer</span> bring them
    back.

    <li class="enumerate" id="x1-48012x6">Stop <span class=
    "pplri7t-">procer</span> and then start it again to see if it
    properly doesn&rsquo;t step on things.
  </ol><!--l. 603-->

  <p class="indent">If you run into problems then just make sure
  that you can run each little piece and that you got the files you
  were supposed to make are correct. The best tool to use is
  <span class="pplri7t-">diff</span>. <!--l. 607-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">4.8</span> <a id=
  "x1-490004.8" name="x1-490004.8"></a>Further Improvements</h3>
  <!--l. 610-->

  <p class="noindent">That ends this chapter, and at this point you
  should know how to setup nearly everything Mongrel2 has to offer
  right now. You should have a good idea of how <span class=
  "pplri7t-">procer</span> will work or not for your real
  deployments, and how it&rsquo;s used by me for my own
  deployments. <!--l. 615-->

  <p class="indent">A <span class="pplri7t-">major</span>
  improvement that we may eventually make is automating setup of
  <span class="pplri7t-">procer</span> profiles, and just better
  overall management of the profiles with <span class=
  "pplri7t-">m2sh</span>. If you feel like hacking on that, just go
  ahead and try and let us know. <!--l. 620-->

  <p class="indent">Other than that, automate, automate, automate. 
  <!--l. 1-->

  <p class="indent">

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;5</span><br>
  <a id="x1-500005" name="x1-500005"></a>Hacking</h2><!--l. 3-->

  <p class="noindent">This chapter is all about making cool things
  with Mongrel2. It covers all the non-deployment features that you
  get from the browser side and the handler/backend side of your
  application. I&rsquo;ll show you how the chat demo works for the
  async web sockets. I&rsquo;ll get into writing your own handlers
  using a few other demos. I&rsquo;ll cover some of the interesting
  things you can do with Mongrel2 you can&rsquo;t do with other
  servers. Finally I&rsquo;ll get into practical things when to do
  proxying and when to use a 0MQ handler. <!--l. 10-->

  <p class="indent">For the majority of this chapter I&rsquo;ll be
  using Python, but the demos should translate to the other
  languages that are implemented. I&rsquo;ll periodically show how
  another language does one of the demos so you can get the idea
  that Mongrel2 is <span class="pplri7t-">language agnostic</span>.
  In no way should you take me using Python in this chapter to mean
  you can&rsquo;t use something else for your handlers. 
  <!--l. 16-->

  <p class="indent">Currently supported languages are:

  <dl class="description">
    <dt class="description"><span class="pplb7t-">Python</span>

    <dd class="description">When you installed the <span class=
    "pplri7t-">m2sh</span> gear you also got a <span class=
    "pplri7t-">mongrel2</span> Python library.

    <dt class="description"><span class="pplb7t-">Ruby</span>

    <dd class="description">Ruby support, and probably the most
    extensive supported language, with good Rack support, by
    <a href="http://github.com/perplexes/m2r">perplexes on
    github</a>.

    <dt class="description"><span class="pplb7t-">C++</span>

    <dd class="description">C++ support by <a href=
    "http://github.com/akrennmair/mongrel2-cpp">akrennmair on
    github</a>

    <dt class="description"><span class="pplb7t-">PHP</span>

    <dd class="description">PHP support by <a href=
    "http://github.com/winks/m2php">winks on github</a>.

    <dt class="description"><span class="pplb7t-">C</span>

    <dd class="description">You can also write handlers in C using
    the Mongrel2 library, but is really rough, so not recommended
    yet. A C library will come though.

    <dt class="description"><span class="pplb7t-">Others?</span>

    <dd class="description"><a href="http://zeromq.org">ZeroMQ</a>
    supports Ada, Basic, C, C++, Common Lisp, Erlang, Go, Haskell,
    Java, Lua, .NET, Objective-C, ooc, Perl, PHP, Python, and Ruby
    so after reading this chapter you can easily write handlers in
    any of those languages too.
  </dl><!--l. 27-->

  <p class="indent">However, no matter how many languages Mongrel2
  supports, you will still have applications that can&rsquo;t fit
  into 0MQ handlers and just work better as classic web apps.
  Either because you&rsquo;ve already written them and have
  existing infrastructure, or because of some architectural issues
  that require it to run traditionally. Because of that Mongrel2
  supports <span class="pplri7t-">HTTP proxying</span> which allows
  you to route requests to basic web server backends that
  don&rsquo;t support 0MQ. <!--l. 33-->

  <p class="indent"><a id="x1-50001r5" name="x1-50001r5"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 5:</span> <span class=
      "content"><span class="pplri7t-">What About</span>
      <span class=
      "pplri7t-">FastCGI/AJP/CGI/SCGI/WSGI/Rack?</span></span>
    </div><!--tex4ht:label?: x1-50001r5 -->

    <div class="quote">
      <!--l. 34-->

      <p class="noindent">Nothing prevents you from writing your
      own connector between Mongrel2 and your deployment protocol
      of choice. If you need to run FastCGI or AJP in your
      environment then your best bet is to just make a handler that
      translates Mongrel2 requests to the protocol you need and
      back. The Mongrel2 format is very easy to parse and translate
      so you should be able to do it no problem. The Ruby library
      already supports Rack as an example, and Python will support
      WSGI soon. <!--l. 41-->

      <p class="noindent">However, Mongrel2 itself doesn&rsquo;t
      support any of these directly. Doing so would bring back the
      language specific infections that cause other web servers to
      go south. The design of most of these protocols tend to be
      either before the modern web, or specific to one particular
      language. Instead of trying to cater to all the possible
      languages out there, Mongrel2 just gives the tools to connect
      to it yourself.
    </div>
  </div>
  <hr class="endfloat">

  <h3 class="sectionHead"><span class="titlemark">5.1</span> <a id=
  "x1-510005.1" name="x1-510005.1"></a>Front-end Goodies</h3>
  <!--l. 51-->

  <p class="noindent">Mongrel2 supports your standard web server
  features like serving files, routing requests to another HTTP
  server, multiple host matching, good 304 support, and just
  generally being able to interact with a browser like normal.
  You&rsquo;ve seen most of these features as you setup and
  deployed a Mongrel2 configuration, but let&rsquo;s go through
  some of them in more detail so you know what&rsquo;s possible. 
  <!--l. 58-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.1.1</span>
  <a id="x1-520005.1.1" name="x1-520005.1.1"></a>HTTP</h4>
  <!--l. 60-->

  <p class="noindent">Mongrel2 uses the original Mongrel parser
  that powers quite a few other web servers and large successful
  websites. This parser is rock solid, dead accurate, and by design
  blocks a lot of security attacks. For the most part you
  don&rsquo;t have to worry about this and just need to know
  Mongrel2 is using the same stable HTTP processing that has been
  working great for many years. <!--l. 65-->

  <p class="indent">Another way to put this is if Mongrel2 says
  your request is invalid, it most definitely is. <!--l. 67-->

  <p class="indent"><a id="x1-52001r6" name="x1-52001r6"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 6:</span> <span class=
      "content"><span class="pplri7t-">Idiots And RFC</span>
      <span class="pplri7t-">Implementers</span></span>
    </div><!--tex4ht:label?: x1-52001r6 -->

    <div class="quote">
      <!--l. 68-->

      <p class="noindent">I don&rsquo;t know why, but people who
      implement RFCs pick up very weird cargo cult beliefs peddled
      by the people who write the standards. In HTTP it was two
      things which the creators of HTTP have actually pack-peddled
      on: Accept everything, and keep-alives with pipe-lines. 
      <!--l. 73-->

      <p class="noindent">The truth is, if you want a secure server
      of *any* kind blindly accepting every single thing any idiots
      sends you is going to open your server up to a huge number of
      attacks. If you look at every attack on existing HTTP servers
      you&rsquo;ll find that about 80% of them are exploiting
      ambiguous parts of the HTTP grammar to pass through malicious
      content or overflow buffers. In Mongrel2 we use a parser that
      rejects invalid requests from first basic principles using
      technology that&rsquo;s 30 years old and backed by solid
      mathematics. Not only does MOngrel2 reject bad requests, but
      it can tell you <span class="pplri7t-">why</span> the request
      was bad, just like a compiler. This doesn&rsquo;t mean
      Mongrel2 is ruthless, but it definitely doesn&rsquo;t
      tolerate ambiguity or stupidity. <!--l. 83-->

      <p class="noindent">Mongrel2 completey supports keep-alives
      because now, since it&rsquo;s not using Ruby <span class=
      "pplri7t-">at all</span> it can scale up beyong 1024 file
      descriptors. Ruby was limited in the number of open files a
      process could have, so the original Mongrel had to break
      keep-alive and kill connections in order to save itself from
      greedy browsers that never close them. Mongrel2 doesn&rsquo;t
      have this limitation so it uses full keep-alives and has a
      dead accurate state machine to manage them correctly. 
      <!--l. 90-->

      <p class="noindent">Where problems come in is with pipe-lined
      requests meaning a browser sends a bunch of requests in a big
      blast, then hangs out for all the responses. This was such a
      horrible stupid idea that pretty much everone gets it wrong
      and doesn&rsquo;t support it fully, if at all. The reason is
      its much too easy to blast a server with a ton of request,
      wait a bit so they hit proxied backends, and then close the
      socket. The web server and the backends are now screwed
      having to handle these requests which will go nowhere. 
      <!--l. 98-->

      <p class="noindent">Mongrel2 does <span class=
      "pplri7t-">not</span> support pipe-lined requests. It sends
      one, and waits for the reponse, and if you want more then
      tough. Screw you because it has <span class=
      "pplri7t-">no</span> advantage for Mongrel2 and dubious
      advantages to you. It is simply one more attack vector for
      the server and is rejected outright. <!--l. 103-->

      <p class="noindent">These two things are rejected outright by
      Mongrel2 simply because they are stupid ideas and in 2010
      nobody should be writing clients so badly that they need
      these features.
    </div>
  </div>
  <hr class="endfloat">

  <h4 class="subsectionHead"><span class="titlemark">5.1.2</span>
  <a id="x1-530005.1.2" name="x1-530005.1.2"></a>Proxying</h4>
  <!--l. 109-->

  <p class="noindent">You&rsquo;ve already seen configurations that
  have the Proxy routes working, so it should be easy to understand
  what&rsquo;s going on. You just create routes to backends that
  are HTTP servers and Mongrel2 shuttles requests to them, then
  proxies responses back. <!--l. 113-->

  <p class="indent">The Proxying support in Mongrel2 is accurate,
  but it&rsquo;s not very capable right now. For example
  there&rsquo;s not round-robin backend selection, or page caching,
  or other things you might need for more serious deployments.
  Those features will come eventually though. <!--l. 117-->

  <p class="indent">What you do get with Mongrel2&rsquo;s proxying
  though is a dead accurate way of slicing up your application by
  routes. Other web servers make you go through great pain in order
  to have some URLs go to a proxy and others go to handlers or
  directories. They make you use odd &rdquo;file syntax&rdquo;,
  weird pseudo-turing logic if-statements, and other odd hacks to
  get flexible route selection. They also tend to not maintain
  keep-alives properly between proxy requests and other requests. 
  <!--l. 124-->

  <p class="indent">Mongrel2 uses the exact same routing syntax for
  all backends and has no distinction between them. It also
  properly does keep-alives for as long as it is efficient to do
  so. <!--l. 128-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.1.3</span>
  <a id="x1-540005.1.3" name="x1-540005.1.3"></a>WebSockets</h4>
  <!--l. 130-->

  <p class="noindent">Mongrel2 supports WebSockets in that if
  someone connects with a WebSocket then it will get sent to
  handlers that use 0MQ and they can interact with it like every
  other request. WebSockets are the least supported though since
  they aren&rsquo;t fully baked and nobody&rsquo;s bothered to
  write helper gear for handlers. They work in theory, but in
  practice haven&rsquo;t really been tried. <!--l. 135-->

  <p class="indent">If you try them out and find things that need
  fixing let us know. <!--l. 137-->

  <p class="indent"><a id="x1-54001r7" name="x1-54001r7"></a>
  <hr class="float">

  <div class="float">
    <div class="caption">
      <span class="id">Note 7:</span> <span class=
      "content"><span class="pplri7t-">Death To</span> <span class=
      "pplri7t-">WebSockets</span></span>
    </div><!--tex4ht:label?: x1-54001r7 -->

    <div class="quote">
      <!--l. 138-->

      <p class="noindent">I am getting sick of these
      &rdquo;Backroom RFCs&rdquo; that are crafted around a bunch
      of huge companies&rsquo; crap implementations found in their
      existing products rather than things real programmers need.
      WebSockets is yet another example of this, with so many odd
      features and annoying agendas that I hope it fails miserably.
      <!--l. 143-->

      <p class="noindent">First, it actually specifies <span class=
      "pplri7t-">unicode</span> for the wire protocol in the HTTP
      headers. This is such a monumental bad idea and will break so
      many web servers and browsers that I&rsquo;m baffled how it
      got into the standard. The only thing I can think of is some
      &rdquo;reverse colonialist&rdquo; who thinks the world should
      a happy rainbow of Unicode demanded it be in there. Unicode
      in the wire protocol adds no linguistic value (nobody reads
      headers), complicates servers, adds security concerns because
      Unicode is ambiguous, and also violates the existing HTTP
      standard which specifies ASCII for the wire protocol. As
      I&rsquo;ve said before in this manual, writing protocols is
      hard enough without having to translate and deal with weird
      UTF-8 Unicode bizarreness. <!--l. 152-->

      <p class="noindent">Second, there is an idiotic
      &rdquo;encryption&rdquo; mechanism for a key exchange that
      can only be described as completely damaged and amateurish.
      The scheme involves taking a regular number and then mixing
      in non-number characters, so <span class=
      "obeylines-h verb pcrr7t-">1234</span> becomes <span class=
      "obeylines-h verb pcrr7t-">1@%^2&#8902;(34</span> and then is
      &rdquo;decrypted&rdquo; by just reading only the digits. Yes,
      this encryption is so advanced you can do it in your head
      visually. I&rsquo;m sorry but any obfuscation that can be
      done by an 11 year old on paper is not encryption and should
      not be used at all. Again, this smacks of some
      &rdquo;clever&rdquo; feature one of the many corporations out
      there invented and not something any real programmer needs. 
      <!--l. 160-->

      <p class="noindent">There&rsquo;s more, but these two alone
      are enough to decide to hold off on WebSockets until they get
      their head straight and specify something that mere mortals
      can hope to implement.
    </div>
  </div>
  <hr class="endfloat">

  <h4 class="subsectionHead"><span class="titlemark">5.1.4</span>
  <a id="x1-550005.1.4" name="x1-550005.1.4"></a>JSSocket</h4>
  <!--l. 167-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.1.5</span>
  <a id="x1-560005.1.5" name="x1-560005.1.5"></a>Long Poll</h4>
  <!--l. 170-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.1.6</span>
  <a id="x1-570005.1.6" name="x1-570005.1.6"></a>Streaming</h4>
  <!--l. 173-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.1.7</span>
  <a id="x1-580005.1.7" name="x1-580005.1.7"></a>N:M Responses</h4>
  <!--l. 177-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.2</span> <a id=
  "x1-590005.2" name="x1-590005.2"></a>Introduction to 0MQ</h3>
  <!--l. 180-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.3</span> <a id=
  "x1-600005.3" name="x1-600005.3"></a>Handlers And Formats</h3>
  <!--l. 183-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.4</span> <a id=
  "x1-610005.4" name="x1-610005.4"></a>Python Handler API</h3>
  <!--l. 186-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.5</span> <a id=
  "x1-620005.5" name="x1-620005.5"></a>Basic Handler Demo</h3>
  <!--l. 189-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.6</span> <a id=
  "x1-630005.6" name="x1-630005.6"></a>Chat Demo</h3><!--l. 192-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.7</span> <a id=
  "x1-640005.7" name="x1-640005.7"></a>MP3 Streaming Demo</h3>
  <!--l. 195-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.8</span> <a id=
  "x1-650005.8" name="x1-650005.8"></a>Other Language APIs</h3>
  <!--l. 198-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.8.1</span>
  <a id="x1-660005.8.1" name="x1-660005.8.1"></a>Ruby Handler
  API</h4><!--l. 201-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.8.2</span>
  <a id="x1-670005.8.2" name="x1-670005.8.2"></a>C++ Handler
  API</h4><!--l. 204-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.8.3</span>
  <a id="x1-680005.8.3" name="x1-680005.8.3"></a>PHP Handler
  API</h4><!--l. 207-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.8.4</span>
  <a id="x1-690005.8.4" name="x1-690005.8.4"></a>Writing Your
  Own</h4><!--l. 210-->

  <p class="noindent">

  <h3 class="sectionHead"><span class="titlemark">5.9</span> <a id=
  "x1-700005.9" name="x1-700005.9"></a>Config Database Schema</h3>
  <!--l. 213-->

  <p class="noindent">

  <h4 class="subsectionHead"><span class="titlemark">5.9.1</span>
  <a id="x1-710005.9.1" name="x1-710005.9.1"></a>Writing Your Own
  m2sh</h4>

  <h2 class="chapterHead"><span class=
  "titlemark">Chapter&nbsp;6</span><br>
  <a id="x1-720006" name="x1-720006"></a>Contributing</h2>
  <!--l. 3-->

  <p class="noindent">Soon...

